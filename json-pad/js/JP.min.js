function isObject(what){return typeof what=="object"}function isArray(obj){if(obj.constructor.toString().indexOf("Array")==-1)return false;else return true}function getObjectType(obj){var type="";if(isObject(obj))type="object";if(isArray(obj))type="array";return type}function isString(a){return typeof a=="string"}function openUrl(url){debug.trace("--OPEN URL '"+url+"'--");var urlReq=new air.URLRequest(url);air.navigateToURL(urlReq)}
function count(mixed_var,mode){var key,cnt=0;if(mixed_var===null)return 0;else if(mixed_var.constructor!==Array&&mixed_var.constructor!==Object)return 1;if(mode==="COUNT_RECURSIVE")mode=1;if(mode!=1)mode=0;for(key in mixed_var){cnt++;if(mode==1&&mixed_var[key]&&(mixed_var[key].constructor===Array||mixed_var[key].constructor===Object))cnt+=this.count(mixed_var[key],1)}return cnt}
function parseXml(xml){var dom=null;var parser=null;if(window.DOMParser)try{parser=new DOMParser;dom=parser.parseFromString(xml,"text/xml")}catch(e){dom=null}else if(window.ActiveXObject)try{dom=new ActiveXObject("Microsoft.XMLDOM");dom.async=false;if(!dom.loadXML(xml))alert("1"+dom.parseError.reason+dom.parseError.srcText)}catch(e){dom=null}return dom}
function validJsonKey(key){if(key.search(/[\W]/)!=-1)return false;if(key.search(/protected/)!=-1)return false;if(key.search(/class/)!=-1)return false;if(key.search(/var/)!=-1)return false;return true}
var debug={trace:function(str){if(Ext.isAir)air.trace(str);else;},dump:function(obj,name){if(name==""||!name)name="NOT ENTERED";debug.trace("============== DUMP VON OBJECT ==============");debug.trace("Name: "+name);debug.trace("typeOf: "+typeof obj);debug.trace("=============================================");debug.trace(debug.dumpObject(obj,0))},dumpObject:function(arr,level){var dumped_text="";if(!level)level=0;var level_padding="";for(var j=1;j<level+1;j++)level_padding+="   ";if(typeof arr==
"object")for(var item in arr){var value=arr[item];if(typeof value=="object"){dumped_text+=level_padding+"'"+item+"':\n";dumped_text+=debug.dumpObject(value,level+1)}else dumped_text+=level_padding+"'"+item+"' => \""+value+'"\n'}else dumped_text="===>"+arr+"<===("+typeof arr+")";return dumped_text}};String.prototype.toFirstUpperCase=function(){return this.substring(0,1).toUpperCase()+this.substring(1,this.length).toLowerCase()};String.prototype.repeat=function(num){return(new Array(num+1)).join(this)};
Array.prototype.in_array=function(needle){for(var i=0;i<this.length;i++)if(this[i]===needle)return true;return false};var UpdateApplication={appUpdater:new runtime.air.update.ApplicationUpdaterUI,configXml:"app:/update-config.xml",getApplicationInfo:function(){var xmlString=air.NativeApplication.nativeApplication.applicationDescriptor;var appXml=new DOMParser;var xmlObject=appXml.parseFromString(xmlString,"text/xml");var root=xmlObject.getElementsByTagName("application")[0];var initialWindow=root.getElementsByTagName("initialWindow")[0];return[root.getElementsByTagName("version")[0].firstChild.data,root.getElementsByTagName("name")[0].firstChild.data,
initialWindow.getElementsByTagName("content")[0].firstChild.data]},getApplicationVersion:function(){return this.getApplicationInfo()[0]},getApplicationName:function(){return this.getApplicationInfo()[1]},checkUpdate:function(){UpdateApplication.appUpdater.checkNow()},onInitialization:function(){UpdateApplication.checkUpdate()},onError:function(event){alert(event.toString())}};
var airApplicationExit=function(){var exitingEvent=new air.Event(air.Event.EXITING,false,true);air.NativeApplication.nativeApplication.dispatchEvent(exitingEvent);if(!exitingEvent.isDefaultPrevented())air.NativeApplication.nativeApplication.exit()};
var JSONpadAir={prefsFile:null,prefsXML:null,stream:null,settings:null,init:function(){if(!air)return;window.nativeWindow.addEventListener(air.Event.CLOSING,JSONpadAir.windowClosingHandler);air.NativeApplication.nativeApplication.addEventListener(air.Event.EXITING,function(e){var opened=air.NativeApplication.nativeApplication.openedWindows;for(var i=0;i<opened.length;i++)opened[i].close()});this.prefsFile=air.File.applicationStorageDirectory;this.prefsFile=this.prefsFile.resolvePath("settings.xml");
this.readXML();UpdateApplication.appUpdater.configurationFile=new air.File(UpdateApplication.configXml);UpdateApplication.appUpdater.addEventListener(air.ErrorEvent.ERROR,UpdateApplication.onError);UpdateApplication.appUpdater.addEventListener("initialized",UpdateApplication.onInitialization);UpdateApplication.appUpdater.initialize()},readXML:function(){this.stream=new air.FileStream;if(this.prefsFile.exists){this.stream.open(this.prefsFile,air.FileMode.READ);this.processXMLData()}else this.saveData(null);
window.nativeWindow.visible=true},processXMLData:function(){this.prefsXML=this.stream.readUTFBytes(this.stream.bytesAvailable);this.stream.close();var domParser=new DOMParser;this.prefsXML=domParser.parseFromString(this.prefsXML,"text/xml");var syntaxHl=this.prefsXML.getElementsByTagName("syntaxHighlighting")[0];this.settings={syntax_hl:syntaxHl.getAttribute("showCodeMirror")}},saveData:function(data){this.createXMLData(data);this.writeXMLData()},createXMLData:function(data){if(data==null)data={syntax_hl:true};
var cr=air.File.lineEnding;this.prefsXML="<?xml version='1.0' encoding='utf-8'?>"+cr+"<preferences>"+cr+"    <syntaxHighlighting showCodeMirror='"+(data.syntax_hl?"true":"false")+"' />"+cr+"    <saveDate>"+(new Date).toString()+"</saveDate>"+cr+"</preferences>"},writeXMLData:function(){this.stream=new air.FileStream;this.stream.open(this.prefsFile,air.FileMode.WRITE);this.stream.writeUTFBytes(this.prefsXML);this.stream.close()},windowClosingHandler:function(event){debug.trace("start windowClosingHandler");
JSONpadAir.saveData({syntax_hl:Ext.getCmp("JPviewPort").findByType("jp_main_top")[0].getTopToolbar().findByType("jp_main_top_iconbar")[0].btnGroup_others.switchHighlighting.pressed});event.preventDefault();nativeWindow.removeEventListener("closing",JSONpadAir.windowClosingHandler);JP.util.air.exit()}};var JSLINT=function(){var adsafe_id,adsafe_may,adsafe_went,anonname,approved,atrule={media:true,"font-face":true,page:true},bang={"<":true,"<=":true,"==":true,"===":true,"!==":true,"!=":true,">":true,">=":true,"+":true,"-":true,"*":true,"/":true,"%":true},banned={arguments:true,callee:true,caller:true,constructor:true,eval:true,prototype:true,stack:true,unwatch:true,valueOf:true,watch:true},boolOptions={adsafe:true,bitwise:true,browser:true,cap:true,css:true,debug:true,devel:true,eqeqeq:true,es5:true,
evil:true,forin:true,fragment:true,immed:true,laxbreak:true,newcap:true,nomen:true,on:true,onevar:true,passfail:true,plusplus:true,regexp:true,rhino:true,undef:true,safe:true,windows:true,strict:true,sub:true,white:true,widget:true},browser={addEventListener:false,blur:false,clearInterval:false,clearTimeout:false,close:false,closed:false,defaultStatus:false,document:false,event:false,focus:false,frames:false,getComputedStyle:false,history:false,Image:false,length:false,location:false,moveBy:false,
moveTo:false,name:false,navigator:false,onbeforeunload:true,onblur:true,onerror:true,onfocus:true,onload:true,onresize:true,onunload:true,open:false,opener:false,Option:false,parent:false,print:false,removeEventListener:false,resizeBy:false,resizeTo:false,screen:false,scroll:false,scrollBy:false,scrollTo:false,setInterval:false,setTimeout:false,status:false,top:false,XMLHttpRequest:false},cssAttributeData,cssAny,cssColorData={aliceblue:true,antiquewhite:true,aqua:true,aquamarine:true,azure:true,beige:true,
bisque:true,black:true,blanchedalmond:true,blue:true,blueviolet:true,brown:true,burlywood:true,cadetblue:true,chartreuse:true,chocolate:true,coral:true,cornflowerblue:true,cornsilk:true,crimson:true,cyan:true,darkblue:true,darkcyan:true,darkgoldenrod:true,darkgray:true,darkgreen:true,darkkhaki:true,darkmagenta:true,darkolivegreen:true,darkorange:true,darkorchid:true,darkred:true,darksalmon:true,darkseagreen:true,darkslateblue:true,darkslategray:true,darkturquoise:true,darkviolet:true,deeppink:true,
deepskyblue:true,dimgray:true,dodgerblue:true,firebrick:true,floralwhite:true,forestgreen:true,fuchsia:true,gainsboro:true,ghostwhite:true,gold:true,goldenrod:true,gray:true,green:true,greenyellow:true,honeydew:true,hotpink:true,indianred:true,indigo:true,ivory:true,khaki:true,lavender:true,lavenderblush:true,lawngreen:true,lemonchiffon:true,lightblue:true,lightcoral:true,lightcyan:true,lightgoldenrodyellow:true,lightgreen:true,lightpink:true,lightsalmon:true,lightseagreen:true,lightskyblue:true,
lightslategray:true,lightsteelblue:true,lightyellow:true,lime:true,limegreen:true,linen:true,magenta:true,maroon:true,mediumaquamarine:true,mediumblue:true,mediumorchid:true,mediumpurple:true,mediumseagreen:true,mediumslateblue:true,mediumspringgreen:true,mediumturquoise:true,mediumvioletred:true,midnightblue:true,mintcream:true,mistyrose:true,moccasin:true,navajowhite:true,navy:true,oldlace:true,olive:true,olivedrab:true,orange:true,orangered:true,orchid:true,palegoldenrod:true,palegreen:true,paleturquoise:true,
palevioletred:true,papayawhip:true,peachpuff:true,peru:true,pink:true,plum:true,powderblue:true,purple:true,red:true,rosybrown:true,royalblue:true,saddlebrown:true,salmon:true,sandybrown:true,seagreen:true,seashell:true,sienna:true,silver:true,skyblue:true,slateblue:true,slategray:true,snow:true,springgreen:true,steelblue:true,tan:true,teal:true,thistle:true,tomato:true,turquoise:true,violet:true,wheat:true,white:true,whitesmoke:true,yellow:true,yellowgreen:true},cssBorderStyle,cssBreak,cssLengthData=
{"%":true,cm:true,em:true,ex:true,"in":true,mm:true,pc:true,pt:true,px:true},cssOverflow,devel={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},escapes={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},funct,functionicity=["closure","exception","global","label","outer","unused","var"],functions,global,htmltag={a:{},abbr:{},acronym:{},address:{},applet:{},area:{empty:true,parent:" map "},article:{},aside:{},audio:{},b:{},
base:{empty:true,parent:" head "},bdo:{},big:{},blockquote:{},body:{parent:" html noframes "},br:{empty:true},button:{},canvas:{parent:" body p div th td "},caption:{parent:" table "},center:{},cite:{},code:{},col:{empty:true,parent:" table colgroup "},colgroup:{parent:" table "},command:{parent:" menu "},datalist:{},dd:{parent:" dl "},del:{},details:{},dialog:{},dfn:{},dir:{},div:{},dl:{},dt:{parent:" dl "},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},frame:{empty:true,parent:" frameset "},
frameset:{parent:" html frameset "},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},head:{parent:" html "},header:{},hgroup:{},html:{parent:"*"},hr:{empty:true},i:{},iframe:{},img:{empty:true},input:{empty:true},ins:{},kbd:{},keygen:{},label:{},legend:{parent:" details fieldset figure "},li:{parent:" dir menu ol ul "},link:{empty:true,parent:" head "},map:{},mark:{},menu:{},meta:{empty:true,parent:" head noframes noscript "},meter:{},nav:{},noframes:{parent:" html body "},noscript:{parent:" body head noframes "},
object:{},ol:{},optgroup:{parent:" select "},option:{parent:" optgroup select "},output:{},p:{},param:{empty:true,parent:" applet object "},pre:{},progress:{},q:{},rp:{},rt:{},ruby:{},samp:{},script:{empty:true,parent:" body div frame head iframe p pre span "},section:{},select:{},small:{},span:{},source:{},strong:{},style:{parent:" head ",empty:true},sub:{},sup:{},table:{},tbody:{parent:" table "},td:{parent:" tr "},textarea:{},tfoot:{parent:" table "},th:{parent:" tr "},thead:{parent:" table "},
time:{},title:{parent:" head "},tr:{parent:" table tbody thead tfoot "},tt:{},u:{},ul:{},"var":{},video:{}},ids,implied,inblock,indent,jsonmode,lines,lookahead,member,membersOnly,nexttoken,noreach,option,predefined,prereg,prevtoken,rhino={defineClass:false,deserialize:false,gc:false,help:false,load:false,loadClass:false,print:false,quit:false,readFile:false,readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},scope,windows={ActiveXObject:false,
CScript:false,Debug:false,Enumerator:false,System:false,VBArray:false,WScript:false},src,stack,standard={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,eval:false,EvalError:false,Function:false,hasOwnProperty:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,RegExp:false,String:false,SyntaxError:false,TypeError:false,
URIError:false},standard_member={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,PI:true,SQRT1_2:true,SQRT2:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,POSITIVE_INFINITY:true},strict_mode,syntax={},tab,token,urls,warnings,widget={alert:true,animator:true,appleScript:true,beep:true,bytesToUIString:true,Canvas:true,chooseColor:true,chooseFile:true,chooseFolder:true,closeWidget:true,COM:true,convertPathToHFS:true,convertPathToPlatform:true,CustomAnimation:true,escape:true,FadeAnimation:true,
filesystem:true,Flash:true,focusWidget:true,form:true,FormField:true,Frame:true,HotKey:true,Image:true,include:true,isApplicationRunning:true,iTunes:true,konfabulatorVersion:true,log:true,md5:true,MenuItem:true,MoveAnimation:true,openURL:true,play:true,Point:true,popupMenu:true,preferenceGroups:true,preferences:true,print:true,prompt:true,random:true,Rectangle:true,reloadWidget:true,ResizeAnimation:true,resolvePath:true,resumeUpdates:true,RotateAnimation:true,runCommand:true,runCommandInBg:true,saveAs:true,
savePreferences:true,screen:true,ScrollBar:true,showWidgetPreferences:true,sleep:true,speak:true,Style:true,suppressUpdates:true,system:true,tellWidget:true,Text:true,TextArea:true,Timer:true,unescape:true,updateNow:true,URL:true,Web:true,widget:true,Window:true,XMLDOM:true,XMLHttpRequest:true,yahooCheckLogin:true,yahooLogin:true,yahooLogout:true},xmode,xquote,ax=/@cc|<\/?|script|\]*s\]|<\s*!|&lt/i,cx=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,
tx=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jslint|members?|global)?|=|\/)?|\*[\/=]?|\+[+=]?|-[\-=]?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,hx=/^\s*(['"=>\/&#]|<(?:\/|\!(?:--)?)?|[a-zA-Z][a-zA-Z0-9_\-]*|[0-9]+|--)/,nx=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,nxg=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
ox=/[>&]|<[\/!]?|--/,lx=/\*\/|\/\*/,ix=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,jx=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,ux=/&|\+|\u00AD|\.\.|\/\*|%[^;]|base64|url|expression|data|mailto/i,sx=/^\s*([{:#%.=,>+\[\]@()"';]|\*=?|\$=|\|=|\^=|~=|[a-zA-Z_][a-zA-Z0-9_\-]*|[0-9]+|<\/|\/\*)/,ssx=/^\s*([@#!"'};:\-%.=,+\[\]()*_]|[a-zA-Z][a-zA-Z0-9._\-]*|\/\*?|\d+(?:\.\d+)?|<\/)/,qx=/[^a-zA-Z0-9+\-_\/ ]/,dx=/[\[\]\/\\"'*<>.&:(){}+=#]/,rx={outer:hx,html:hx,style:sx,styleproperty:ssx};function F(){}
if(typeof Object.create!=="function")Object.create=function(o){F.prototype=o;return new F};function is_own(object,name){return Object.prototype.hasOwnProperty.call(object,name)}function combine(t,o){var n;for(n in o)if(is_own(o,n))t[n]=o[n]}String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};String.prototype.isAlpha=function(){return this>="a"&&this<="z\uffff"||this>="A"&&this<="Z\uffff"};String.prototype.isDigit=function(){return this>=
"0"&&this<="9"};String.prototype.supplant=function(o){return this.replace(/\{([^{}]*)\}/g,function(a,b){var r=o[b];return typeof r==="string"||typeof r==="number"?r:a})};String.prototype.name=function(){if(ix.test(this))return this;if(nx.test(this))return'"'+this.replace(nxg,function(a){var c=escapes[a];if(c)return c;return"\\u"+("0000"+a.charCodeAt().toString(16)).slice(-4)})+'"';return'"'+this+'"'};function assume(){if(!option.safe){if(option.rhino)combine(predefined,rhino);if(option.devel)combine(predefined,
devel);if(option.browser)combine(predefined,browser);if(option.windows)combine(predefined,windows);if(option.widget)combine(predefined,widget)}}function quit(m,l,ch){throw{name:"JSLintError",line:l,character:ch,message:m+" ("+Math.floor(l/lines.length*100)+"% scanned)."};}function warning(m,t,a,b,c,d){var ch,l,w;t=t||nexttoken;if(t.id==="(end)")t=token;l=t.line||0;ch=t.from||0;w={id:"(error)",raw:m,evidence:lines[l-1]||"",line:l,character:ch,a:a,b:b,c:c,d:d};w.reason=m.supplant(w);JSLINT.errors.push(w);
if(option.passfail)quit("Stopping. ",l,ch);warnings+=1;if(warnings>=option.maxerr)quit("Too many errors.",l,ch);return w}function warningAt(m,l,ch,a,b,c,d){return warning(m,{line:l,from:ch},a,b,c,d)}function error(m,t,a,b,c,d){var w=warning(m,t,a,b,c,d);quit("Stopping, unable to continue.",w.line,w.character)}function errorAt(m,l,ch,a,b,c,d){return error(m,{line:l,from:ch},a,b,c,d)}var lex=function lex(){var character,from,line,s;function nextLine(){var at;if(line>=lines.length)return false;character=
1;s=lines[line];line+=1;at=s.search(/ \t/);if(at>=0)warningAt("Mixed spaces and tabs.",line,at+1);s=s.replace(/\t/g,tab);at=s.search(cx);if(at>=0)warningAt("Unsafe character.",line,at);if(option.maxlen&&option.maxlen<s.length)warningAt("Line too long.",line,s.length);return true}function it(type,value){var i,t;if(type==="(color)")t={type:type};else if(type==="(punctuator)"||type==="(identifier)"&&is_own(syntax,value))t=syntax[value]||syntax["(error)"];else t=syntax[type];t=Object.create(t);if(type===
"(string)"||type==="(range)")if(jx.test(value))warningAt("Script URL.",line,from);if(type==="(identifier)"){t.identifier=true;if(value==="__iterator__"||value==="__proto__")errorAt("Reserved name '{a}'.",line,from,value);else if(option.nomen&&(value.charAt(0)==="_"||value.charAt(value.length-1)==="_"))warningAt("Unexpected {a} in '{b}'.",line,from,"dangling '_'",value)}t.value=value;t.line=line;t.character=character;t.from=from;i=t.id;if(i!=="(endline)")prereg=i&&("(,=:[!&|?{};".indexOf(i.charAt(i.length-
1))>=0||i==="return");return t}return{init:function(source){if(typeof source==="string")lines=source.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n");else lines=source;line=0;nextLine();from=1},range:function(begin,end){var c,value="";from=character;if(s.charAt(0)!==begin)errorAt("Expected '{a}' and instead saw '{b}'.",line,character,begin,s.charAt(0));for(;;){s=s.slice(1);character+=1;c=s.charAt(0);switch(c){case "":errorAt("Missing '{a}'.",line,character,c);break;case end:s=s.slice(1);character+=
1;return it("(range)",value);case xquote:case "\\":warningAt("Unexpected '{a}'.",line,character,c)}value+=c}},token:function(){var b,c,captures,d,depth,high,i,l,low,q,t;function match(x){var r=x.exec(s),r1;if(r){l=r[0].length;r1=r[1];c=r1.charAt(0);s=s.substr(l);from=character+l-r1.length;character+=l;return r1}}function string(x){var c,j,r="";if(jsonmode&&x!=='"')warningAt("Strings must use doublequote.",line,character);if(xquote===x||xmode==="scriptstring"&&!xquote)return it("(punctuator)",x);function esc(n){var i=
parseInt(s.substr(j+1,n),16);j+=n;if(i>=32&&i<=126&&i!==34&&i!==92&&i!==39)warningAt("Unnecessary escapement.",line,character);character+=n;c=String.fromCharCode(i)}j=0;for(;;){while(j>=s.length){j=0;if(xmode!=="html"||!nextLine())errorAt("Unclosed string.",line,from)}c=s.charAt(j);if(c===x){character+=1;s=s.substr(j+1);return it("(string)",r,x)}if(c<" "){if(c==="\n"||c==="\r")break;warningAt("Control character in string: {a}.",line,character+j,s.slice(0,j))}else if(c===xquote)warningAt("Bad HTML string",
line,character+j);else if(c==="<")if(option.safe&&xmode==="html")warningAt("ADsafe string violation.",line,character+j);else if(s.charAt(j+1)==="/"&&(xmode||option.safe))warningAt("Expected '<\\/' and instead saw '</'.",line,character);else{if(s.charAt(j+1)==="!"&&(xmode||option.safe))warningAt("Unexpected '<!' in a string.",line,character)}else if(c==="\\")if(xmode==="html"){if(option.safe)warningAt("ADsafe string violation.",line,character+j)}else if(xmode==="styleproperty"){j+=1;character+=1;c=
s.charAt(j);if(c!==x)warningAt("Escapement in style string.",line,character+j)}else{j+=1;character+=1;c=s.charAt(j);switch(c){case xquote:warningAt("Bad HTML string",line,character+j);break;case "\\":case "'":case '"':case "/":break;case "b":c="\u0008";break;case "f":c="\u000c";break;case "n":c="\n";break;case "r":c="\r";break;case "t":c="\t";break;case "u":esc(4);break;case "v":c="\u000b";break;case "x":if(jsonmode)warningAt("Avoid \\x-.",line,character);esc(2);break;default:warningAt("Bad escapement.",
line,character)}}r+=c;character+=1;j+=1}}for(;;){if(!s)return it(nextLine()?"(endline)":"(end)","");while(xmode==="outer"){i=s.search(ox);if(i===0)break;else if(i>0){character+=1;s=s.slice(i);break}else if(!nextLine())return it("(end)","")}t=match(rx[xmode]||tx);if(!t){t="";c="";while(s&&s<"!")s=s.substr(1);if(s)if(xmode==="html")return it("(error)",s.charAt(0));else errorAt("Unexpected '{a}'.",line,character,s.substr(0,1))}else{if(c.isAlpha()||c==="_"||c==="$")return it("(identifier)",t);if(c.isDigit()){if(xmode!==
"style"&&!isFinite(Number(t)))warningAt("Bad number '{a}'.",line,character,t);if(xmode!=="style"&&xmode!=="styleproperty"&&s.substr(0,1).isAlpha())warningAt("Missing space after '{a}'.",line,character,t);if(c==="0"){d=t.substr(1,1);if(d.isDigit()){if(token.id!=="."&&xmode!=="styleproperty")warningAt("Don't use extra leading zeros '{a}'.",line,character,t)}else if(jsonmode&&(d==="x"||d==="X"))warningAt("Avoid 0x-. '{a}'.",line,character,t)}if(t.substr(t.length-1)===".")warningAt("A trailing decimal point can be confused with a dot '{a}'.",
line,character,t);return it("(number)",t)}switch(t){case '"':case "'":return string(t);case "//":if(src||xmode&&xmode!=="script")warningAt("Unexpected comment.",line,character);else if(xmode==="script"&&/<\s*\//i.test(s))warningAt("Unexpected </ in comment.",line,character);else if((option.safe||xmode==="script")&&ax.test(s))warningAt("Dangerous comment.",line,character);s="";token.comment=true;break;case "/*":if(src||xmode&&xmode!=="script"&&xmode!=="style"&&xmode!=="styleproperty")warningAt("Unexpected comment.",
line,character);if(option.safe&&ax.test(s))warningAt("ADsafe comment violation.",line,character);for(;;){i=s.search(lx);if(i>=0)break;if(!nextLine())errorAt("Unclosed comment.",line,character);else if(option.safe&&ax.test(s))warningAt("ADsafe comment violation.",line,character)}character+=i+2;if(s.substr(i,1)==="/")errorAt("Nested comment.",line,character);s=s.substr(i+2);token.comment=true;break;case "/*members":case "/*member":case "/*jslint":case "/*global":case "*/":return{value:t,type:"special",
line:line,character:character,from:from};case "":break;case "/":if(token.id==="/=")errorAt("A regular expression literal can be confused with '/='.",line,from);if(prereg){depth=0;captures=0;l=0;for(;;){b=true;c=s.charAt(l);l+=1;switch(c){case "":errorAt("Unclosed regular expression.",line,from);return;case "/":if(depth>0)warningAt("Unescaped '{a}'.",line,from+l,"/");c=s.substr(0,l-1);q={g:true,i:true,m:true};while(q[s.charAt(l)]===true){q[s.charAt(l)]=false;l+=1}character+=l;s=s.substr(l);q=s.charAt(0);
if(q==="/"||q==="*")errorAt("Confusing regular expression.",line,from);return it("(regexp)",c);case "\\":c=s.charAt(l);if(c<" ")warningAt("Unexpected control character in regular expression.",line,from+l);else if(c==="<")warningAt("Unexpected escaped character '{a}' in regular expression.",line,from+l,c);l+=1;break;case "(":depth+=1;b=false;if(s.charAt(l)==="?"){l+=1;switch(s.charAt(l)){case ":":case "=":case "!":l+=1;break;default:warningAt("Expected '{a}' and instead saw '{b}'.",line,from+l,":",
s.charAt(l))}}else captures+=1;break;case "|":b=false;break;case ")":if(depth===0)warningAt("Unescaped '{a}'.",line,from+l,")");else depth-=1;break;case " ":q=1;while(s.charAt(l)===" "){l+=1;q+=1}if(q>1)warningAt("Spaces are hard to count. Use {{a}}.",line,from+l,q);break;case "[":c=s.charAt(l);if(c==="^"){l+=1;if(option.regexp)warningAt("Insecure '{a}'.",line,from+l,c)}q=false;if(c==="]"){warningAt("Empty class.",line,from+l-1);q=true}klass:do{c=s.charAt(l);l+=1;switch(c){case "[":case "^":warningAt("Unescaped '{a}'.",
line,from+l,c);q=true;break;case "-":if(q)q=false;else{warningAt("Unescaped '{a}'.",line,from+l,"-");q=true}break;case "]":if(!q)warningAt("Unescaped '{a}'.",line,from+l-1,"-");break klass;case "\\":c=s.charAt(l);if(c<" ")warningAt("Unexpected control character in regular expression.",line,from+l);else if(c==="<")warningAt("Unexpected escaped character '{a}' in regular expression.",line,from+l,c);l+=1;q=true;break;case "/":warningAt("Unescaped '{a}'.",line,from+l-1,"/");q=true;break;case "<":if(xmode===
"script"){c=s.charAt(l);if(c==="!"||c==="/")warningAt("HTML confusion in regular expression '<{a}'.",line,from+l,c)}q=true;break;default:q=true}}while(c);break;case ".":if(option.regexp)warningAt("Insecure '{a}'.",line,from+l,c);break;case "]":case "?":case "{":case "}":case "+":case "*":warningAt("Unescaped '{a}'.",line,from+l,c);break;case "<":if(xmode==="script"){c=s.charAt(l);if(c==="!"||c==="/")warningAt("HTML confusion in regular expression '<{a}'.",line,from+l,c)}}if(b)switch(s.charAt(l)){case "?":case "+":case "*":l+=
1;if(s.charAt(l)==="?")l+=1;break;case "{":l+=1;c=s.charAt(l);if(c<"0"||c>"9")warningAt("Expected a number and instead saw '{a}'.",line,from+l,c);l+=1;low=+c;for(;;){c=s.charAt(l);if(c<"0"||c>"9")break;l+=1;low=+c+low*10}high=low;if(c===","){l+=1;high=Infinity;c=s.charAt(l);if(c>="0"&&c<="9"){l+=1;high=+c;for(;;){c=s.charAt(l);if(c<"0"||c>"9")break;l+=1;high=+c+high*10}}}if(s.charAt(l)!=="}")warningAt("Expected '{a}' and instead saw '{b}'.",line,from+l,"}",c);else l+=1;if(s.charAt(l)==="?")l+=1;if(low>
high)warningAt("'{a}' should not be greater than '{b}'.",line,from+l,low,high)}}c=s.substr(0,l-1);character+=l;s=s.substr(l);return it("(regexp)",c)}return it("(punctuator)",t);case "<!--":l=line;c=character;for(;;){i=s.indexOf("--");if(i>=0)break;i=s.indexOf("<!");if(i>=0)errorAt("Nested HTML comment.",line,character+i);if(!nextLine())errorAt("Unclosed HTML comment.",l,c)}l=s.indexOf("<!");if(l>=0&&l<i)errorAt("Nested HTML comment.",line,character+l);character+=i;if(s[i+2]!==">")errorAt("Expected --\>.",
line,character);character+=3;s=s.slice(i+3);break;case "#":if(xmode==="html"||xmode==="styleproperty"){for(;;){c=s.charAt(0);if((c<"0"||c>"9")&&(c<"a"||c>"f")&&(c<"A"||c>"F"))break;character+=1;s=s.substr(1);t+=c}if(t.length!==4&&t.length!==7)warningAt("Bad hex color '{a}'.",line,from+l,t);return it("(color)",t)}return it("(punctuator)",t);default:if(xmode==="outer"&&c==="&"){character+=1;s=s.substr(1);for(;;){c=s.charAt(0);character+=1;s=s.substr(1);if(c===";")break;if(!(c>="0"&&c<="9"||c>="a"&&
c<="z"||c==="#"))errorAt("Bad entity",line,from+l,character)}break}return it("(punctuator)",t)}}}}}}();function addlabel(t,type){if(option.safe&&funct["(global)"]&&typeof predefined[t]!=="boolean")warning("ADsafe global: "+t+".",token);else if(t==="hasOwnProperty")warning("'hasOwnProperty' is a really bad name.");if(is_own(funct,t)&&!funct["(global)"])warning(funct[t]===true?"'{a}' was used before it was defined.":"'{a}' is already defined.",nexttoken,t);funct[t]=type;if(funct["(global)"]){global[t]=
funct;if(is_own(implied,t)){warning("'{a}' was used before it was defined.",nexttoken,t);delete implied[t]}}else scope[t]=funct}function doOption(){var b,obj,filter,o=nexttoken.value,t,v;switch(o){case "*/":error("Unbegun comment.");break;case "/*members":case "/*member":o="/*members";if(!membersOnly)membersOnly={};obj=membersOnly;break;case "/*jslint":if(option.safe)warning("ADsafe restriction.");obj=option;filter=boolOptions;break;case "/*global":if(option.safe)warning("ADsafe restriction.");obj=
predefined;break;default:}t=lex.token();loop:for(;;){for(;;){if(t.type==="special"&&t.value==="*/")break loop;if(t.id!=="(endline)"&&t.id!==",")break;t=lex.token()}if(t.type!=="(string)"&&t.type!=="(identifier)"&&o!=="/*members")error("Bad option.",t);v=lex.token();if(v.id===":"){v=lex.token();if(obj===membersOnly)error("Expected '{a}' and instead saw '{b}'.",t,"*/",":");if(t.value==="indent"&&o==="/*jslint"){b=+v.value;if(typeof b!=="number"||!isFinite(b)||b<=0||Math.floor(b)!==b)error("Expected a small integer and instead saw '{a}'.",
v,v.value);obj.white=true;obj.indent=b}else if(t.value==="maxerr"&&o==="/*jslint"){b=+v.value;if(typeof b!=="number"||!isFinite(b)||b<=0||Math.floor(b)!==b)error("Expected a small integer and instead saw '{a}'.",v,v.value);obj.maxerr=b}else if(t.value==="maxlen"&&o==="/*jslint"){b=+v.value;if(typeof b!=="number"||!isFinite(b)||b<=0||Math.floor(b)!==b)error("Expected a small integer and instead saw '{a}'.",v,v.value);obj.maxlen=b}else if(v.value==="true")obj[t.value]=true;else if(v.value==="false")obj[t.value]=
false;else error("Bad option value.",v);t=lex.token()}else{if(o==="/*jslint")error("Missing option value.",t);obj[t.value]=false;t=v}}if(filter)assume()}function peek(p){var i=p||0,j=0,t;while(j<=i){t=lookahead[j];if(!t)t=lookahead[j]=lex.token();j+=1}return t}function advance(id,t){switch(token.id){case "(number)":if(nexttoken.id===".")warning("A dot following a number can be confused with a decimal point.",token);break;case "-":if(nexttoken.id==="-"||nexttoken.id==="--")warning("Confusing minusses.");
break;case "+":if(nexttoken.id==="+"||nexttoken.id==="++")warning("Confusing plusses.");break}if(token.type==="(string)"||token.identifier)anonname=token.value;if(id&&nexttoken.id!==id)if(t)if(nexttoken.id==="(end)")warning("Unmatched '{a}'.",t,t.id);else warning("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",nexttoken,id,t.id,t.line,nexttoken.value);else if(nexttoken.type!=="(identifier)"||nexttoken.value!==id)warning("Expected '{a}' and instead saw '{b}'.",nexttoken,id,nexttoken.value);
prevtoken=token;token=nexttoken;for(;;){nexttoken=lookahead.shift()||lex.token();if(nexttoken.id==="(end)"||nexttoken.id==="(error)")return;if(nexttoken.type==="special")doOption();else if(nexttoken.id!=="(endline)")break}}function parse(rbp,initial){var left;if(nexttoken.id==="(end)")error("Unexpected early end of program.",token);advance();if(option.safe&&typeof predefined[token.value]==="boolean"&&nexttoken.id!=="("&&nexttoken.id!==".")warning("ADsafe violation.",token);if(initial){anonname="anonymous";
funct["(verb)"]=token.value}if(initial===true&&token.fud)left=token.fud();else{if(token.nud)left=token.nud();else if(nexttoken.type==="(number)"&&token.id==="."){warning("A leading decimal point can be confused with a dot: '.{a}'.",token,nexttoken.value);advance();return token}else error("Expected an identifier and instead saw '{a}'.",token,token.id);while(rbp<nexttoken.lbp){advance();if(token.led)left=token.led(left);else error("Expected an operator and instead saw '{a}'.",token,token.id)}}return left}
function adjacent(left,right){left=left||token;right=right||nexttoken;if(option.white||xmode==="styleproperty"||xmode==="style")if(left.character!==right.from&&left.line===right.line)warning("Unexpected space after '{a}'.",right,left.value)}function nospace(left,right){left=left||token;right=right||nexttoken;if(option.white&&!left.comment)if(left.line===right.line)adjacent(left,right)}function nonadjacent(left,right){if(option.white){left=left||token;right=right||nexttoken;if(left.line===right.line&&
left.character===right.from)warning("Missing space after '{a}'.",nexttoken,left.value)}}function nobreaknonadjacent(left,right){left=left||token;right=right||nexttoken;if(!option.laxbreak&&left.line!==right.line)warning("Bad line breaking before '{a}'.",right,right.id);else if(option.white){left=left||token;right=right||nexttoken;if(left.character===right.from)warning("Missing space after '{a}'.",nexttoken,left.value)}}function indentation(bias){var i;if(option.white&&nexttoken.id!=="(end)"){i=indent+
(bias||0);if(nexttoken.from!==i)warning("Expected '{a}' to have an indentation at {b} instead at {c}.",nexttoken,nexttoken.value,i,nexttoken.from)}}function nolinebreak(t){t=t||token;if(t.line!==nexttoken.line)warning("Line breaking error '{a}'.",t,t.value)}function comma(){if(token.line!==nexttoken.line){if(!option.laxbreak)warning("Bad line breaking before '{a}'.",token,nexttoken.id)}else if(token.character!==nexttoken.from&&option.white)warning("Unexpected space after '{a}'.",nexttoken,token.value);
advance(",");nonadjacent(token,nexttoken)}function symbol(s,p){var x=syntax[s];if(!x||typeof x!=="object")syntax[s]=x={id:s,lbp:p,value:s};return x}function delim(s){return symbol(s,0)}function stmt(s,f){var x=delim(s);x.identifier=x.reserved=true;x.fud=f;return x}function blockstmt(s,f){var x=stmt(s,f);x.block=true;return x}function reserveName(x){var c=x.id.charAt(0);if(c>="a"&&c<="z"||c>="A"&&c<="Z")x.identifier=x.reserved=true;return x}function prefix(s,f){var x=symbol(s,150);reserveName(x);x.nud=
typeof f==="function"?f:function(){this.right=parse(150);this.arity="unary";if(this.id==="++"||this.id==="--")if(option.plusplus)warning("Unexpected use of '{a}'.",this,this.id);else if((!this.right.identifier||this.right.reserved)&&this.right.id!=="."&&this.right.id!=="[")warning("Bad operand.",this);return this};return x}function type(s,f){var x=delim(s);x.type=s;x.nud=f;return x}function reserve(s,f){var x=type(s,f);x.identifier=x.reserved=true;return x}function reservevar(s,v){return reserve(s,
function(){if(this.id==="this"||this.id==="arguments"||this.id==="eval")if(strict_mode&&funct["(global)"])warning("Strict violation.",this);else if(option.safe)warning("ADsafe violation.",this);return this})}function infix(s,f,p,w){var x=symbol(s,p);reserveName(x);x.led=function(left){if(!w){nobreaknonadjacent(prevtoken,token);nonadjacent(token,nexttoken)}if(typeof f==="function")return f(left,this);else{this.left=left;this.right=parse(p);return this}};return x}function relation(s,f){var x=symbol(s,
100);x.led=function(left){nobreaknonadjacent(prevtoken,token);nonadjacent(token,nexttoken);var right=parse(100);if(left&&left.id==="NaN"||right&&right.id==="NaN")warning("Use the isNaN function to compare with NaN.",this);else if(f)f.apply(this,[left,right]);if(left.id==="!")warning("Confusing use of '{a}'.",left,"!");if(right.id==="!")warning("Confusing use of '{a}'.",left,"!");this.left=left;this.right=right;return this};return x}function isPoorRelation(node){return node&&(node.type==="(number)"&&
+node.value===0||node.type==="(string)"&&node.value===" "||node.type==="true"||node.type==="false"||node.type==="undefined"||node.type==="null")}function assignop(s,f){symbol(s,20).exps=true;return infix(s,function(left,that){var l;that.left=left;if(predefined[left.value]===false&&scope[left.value]["(global)"]===true)warning("Read only.",left);if(option.safe){l=left;do{if(typeof predefined[l.value]==="boolean")warning("ADsafe violation.",l);l=l.left}while(l)}if(left){if(left.id==="."||left.id==="["){if(!left.left||
left.left.value==="arguments")warning("Bad assignment.",that);that.right=parse(19);return that}else if(left.identifier&&!left.reserved){if(funct[left.value]==="exception")warning("Do not assign to the exception parameter.",left);that.right=parse(19);return that}if(left===syntax["function"])warning("Expected an identifier in an assignment and instead saw a function invocation.",token)}error("Bad assignment.",that)},20)}function bitwise(s,f,p){var x=symbol(s,p);reserveName(x);x.led=typeof f==="function"?
f:function(left){if(option.bitwise)warning("Unexpected use of '{a}'.",this,this.id);this.left=left;this.right=parse(p);return this};return x}function bitwiseassignop(s){symbol(s,20).exps=true;return infix(s,function(left,that){if(option.bitwise)warning("Unexpected use of '{a}'.",that,that.id);nonadjacent(prevtoken,token);nonadjacent(token,nexttoken);if(left){if(left.id==="."||left.id==="["||left.identifier&&!left.reserved){parse(19);return that}if(left===syntax["function"])warning("Expected an identifier in an assignment, and instead saw a function invocation.",
token);return that}error("Bad assignment.",that)},20)}function suffix(s,f){var x=symbol(s,150);x.led=function(left){if(option.plusplus)warning("Unexpected use of '{a}'.",this,this.id);else if((!left.identifier||left.reserved)&&left.id!=="."&&left.id!=="[")warning("Bad operand.",this);this.left=left;return this};return x}function optionalidentifier(){if(nexttoken.identifier){advance();if(option.safe&&banned[token.value])warning("ADsafe violation: '{a}'.",token,token.value);else if(token.reserved&&
!option.es5)warning("Expected an identifier and instead saw '{a}' (a reserved word).",token,token.id);return token.value}}function identifier(){var i=optionalidentifier();if(i)return i;if(token.id==="function"&&nexttoken.id==="(")warning("Missing name in function statement.");else error("Expected an identifier and instead saw '{a}'.",nexttoken,nexttoken.value)}function reachable(s){var i=0,t;if(nexttoken.id!==";"||noreach)return;for(;;){t=peek(i);if(t.reach)return;if(t.id!=="(endline)"){if(t.id===
"function"){warning("Inner functions should be listed at the top of the outer function.",t);break}warning("Unreachable '{a}' after '{b}'.",t,t.value,s);break}i+=1}}function statement(noindent){var i=indent,r,s=scope,t=nexttoken;if(t.id===";"){warning("Unnecessary semicolon.",t);advance(";");return}if(t.identifier&&!t.reserved&&peek().id===":"){advance();advance(":");scope=Object.create(s);addlabel(t.value,"label");if(!nexttoken.labelled)warning("Label '{a}' on {b} statement.",nexttoken,t.value,nexttoken.value);
if(jx.test(t.value+":"))warning("Label '{a}' looks like a javascript url.",t,t.value);nexttoken.label=t.value;t=nexttoken}if(!noindent)indentation();r=parse(0,true);if(!t.block){if(!r||!r.exps)warning("Expected an assignment or function call and instead saw an expression.",token);else if(r.id==="("&&r.left.id==="new")warning("Do not use 'new' for side effects.");if(nexttoken.id!==";")warningAt("Missing semicolon.",token.line,token.from+token.value.length);else{adjacent(token,nexttoken);advance(";");
nonadjacent(token,nexttoken)}}indent=i;scope=s;return r}function use_strict(){if(nexttoken.value==="use strict"){advance();advance(";");strict_mode=true;return true}else return false}function statements(begin){var a=[],f,p;if(begin&&!use_strict()&&option.strict)warning('Missing "use strict" statement.',nexttoken);if(option.adsafe)switch(begin){case "script":if(!adsafe_may)if(nexttoken.value!=="ADSAFE"||peek(0).id!=="."||peek(1).value!=="id"&&peek(1).value!=="go")error("ADsafe violation: Missing ADSAFE.id or ADSAFE.go.",
nexttoken);if(nexttoken.value==="ADSAFE"&&peek(0).id==="."&&peek(1).value==="id"){if(adsafe_may)error("ADsafe violation.",nexttoken);advance("ADSAFE");advance(".");advance("id");advance("(");if(nexttoken.value!==adsafe_id)error("ADsafe violation: id does not match.",nexttoken);advance("(string)");advance(")");advance(";");adsafe_may=true}break;case "lib":if(nexttoken.value==="ADSAFE"){advance("ADSAFE");advance(".");advance("lib");advance("(");advance("(string)");comma();f=parse(0);if(f.id!=="function")error("The second argument to lib must be a function.",
f);p=f.funct["(params)"];p=p&&p.join(", ");if(p&&p!=="lib")error("Expected '{a}' and instead saw '{b}'.",f,"(lib)","("+p+")");advance(")");advance(";");return a}else error("ADsafe lib violation.")}while(!nexttoken.reach&&nexttoken.id!=="(end)")if(nexttoken.id===";"){warning("Unnecessary semicolon.");advance(";")}else a.push(statement());return a}function block(f){var a,b=inblock,old_indent=indent,s=scope,t;inblock=f;scope=Object.create(scope);nonadjacent(token,nexttoken);t=nexttoken;if(nexttoken.id===
"{"){advance("{");if(nexttoken.id!=="}"||token.line!==nexttoken.line){indent+=option.indent;while(!f&&nexttoken.from>indent)indent+=option.indent;if(!f)use_strict();a=statements();indent-=option.indent;indentation()}advance("}",t);indent=old_indent}else{warning("Expected '{a}' and instead saw '{b}'.",nexttoken,"{",nexttoken.value);noreach=true;a=[statement()];noreach=false}funct["(verb)"]=null;scope=s;inblock=b;return a}function idValue(){return this}function countMember(m){if(membersOnly&&typeof membersOnly[m]!==
"boolean")warning("Unexpected /*member '{a}'.",token,m);if(typeof member[m]==="number")member[m]+=1;else member[m]=1}function note_implied(token){var name=token.value,line=token.line,a=implied[name];if(typeof a==="function")a=false;if(!a){a=[line];implied[name]=a}else if(a[a.length-1]!==line)a.push(line)}function cssName(){if(nexttoken.identifier){advance();return true}}function cssNumber(){if(nexttoken.id==="-"){advance("-");adjacent();nolinebreak()}if(nexttoken.type==="(number)"){advance("(number)");
return true}}function cssString(){if(nexttoken.type==="(string)"){advance();return true}}function cssColor(){var i,number,value;if(nexttoken.identifier){value=nexttoken.value;if(value==="rgb"||value==="rgba"){advance();advance("(");for(i=0;i<3;i+=1){if(i)advance(",");number=nexttoken.value;if(nexttoken.type!=="(number)"||number<0){warning("Expected a positive number and instead saw '{a}'",nexttoken,number);advance()}else{advance();if(nexttoken.id==="%"){advance("%");if(number>100)warning("Expected a percentage and instead saw '{a}'",
token,number)}else if(number>255)warning("Expected a small number and instead saw '{a}'",token,number)}}if(value==="rgba"){advance(",");number=+nexttoken.value;if(nexttoken.type!=="(number)"||number<0||number>1)warning("Expected a number between 0 and 1 and instead saw '{a}'",nexttoken,number);advance();if(nexttoken.id==="%"){warning("Unexpected '%'.");advance("%")}}advance(")");return true}else if(cssColorData[nexttoken.value]===true){advance();return true}}else if(nexttoken.type==="(color)"){advance();
return true}return false}function cssLength(){if(nexttoken.id==="-"){advance("-");adjacent();nolinebreak()}if(nexttoken.type==="(number)"){advance();if(nexttoken.type!=="(string)"&&cssLengthData[nexttoken.value]===true){adjacent();advance()}else if(+token.value!==0)warning("Expected a linear unit and instead saw '{a}'.",nexttoken,nexttoken.value);return true}return false}function cssLineHeight(){if(nexttoken.id==="-"){advance("-");adjacent()}if(nexttoken.type==="(number)"){advance();if(nexttoken.type!==
"(string)"&&cssLengthData[nexttoken.value]===true){adjacent();advance()}return true}return false}function cssWidth(){if(nexttoken.identifier)switch(nexttoken.value){case "thin":case "medium":case "thick":advance();return true}else return cssLength()}function cssMargin(){if(nexttoken.identifier){if(nexttoken.value==="auto"){advance();return true}}else return cssLength()}function cssAttr(){if(nexttoken.identifier&&nexttoken.value==="attr"){advance();advance("(");if(!nexttoken.identifier)warning("Expected a name and instead saw '{a}'.",
nexttoken,nexttoken.value);advance();advance(")");return true}return false}function cssCommaList(){while(nexttoken.id!==";"){if(!cssName()&&!cssString())warning("Expected a name and instead saw '{a}'.",nexttoken,nexttoken.value);if(nexttoken.id!==",")return true;comma()}}function cssCounter(){if(nexttoken.identifier&&nexttoken.value==="counter"){advance();advance("(");if(!nexttoken.identifier);advance();if(nexttoken.id===","){comma();if(nexttoken.type!=="(string)")warning("Expected a string and instead saw '{a}'.",
nexttoken,nexttoken.value);advance()}advance(")");return true}if(nexttoken.identifier&&nexttoken.value==="counters"){advance();advance("(");if(!nexttoken.identifier)warning("Expected a name and instead saw '{a}'.",nexttoken,nexttoken.value);advance();if(nexttoken.id===","){comma();if(nexttoken.type!=="(string)")warning("Expected a string and instead saw '{a}'.",nexttoken,nexttoken.value);advance()}if(nexttoken.id===","){comma();if(nexttoken.type!=="(string)")warning("Expected a string and instead saw '{a}'.",
nexttoken,nexttoken.value);advance()}advance(")");return true}return false}function cssShape(){var i;if(nexttoken.identifier&&nexttoken.value==="rect"){advance();advance("(");for(i=0;i<4;i+=1)if(!cssLength()){warning("Expected a number and instead saw '{a}'.",nexttoken,nexttoken.value);break}advance(")");return true}return false}function cssUrl(){var c,url;if(nexttoken.identifier&&nexttoken.value==="url"){nexttoken=lex.range("(",")");url=nexttoken.value;c=url.charAt(0);if(c==='"'||c==="'")if(url.slice(-1)!==
c)warning("Bad url string.");else{url=url.slice(1,-1);if(url.indexOf(c)>=0)warning("Bad url string.")}if(!url)warning("Missing url.");advance();if(option.safe&&ux.test(url))error("ADsafe URL violation.");urls.push(url);return true}return false}cssAny=[cssUrl,function(){for(;;)if(nexttoken.identifier)switch(nexttoken.value.toLowerCase()){case "url":cssUrl();break;case "expression":warning("Unexpected expression '{a}'.",nexttoken,nexttoken.value);advance();break;default:advance()}else{if(nexttoken.id===
";"||nexttoken.id==="!"||nexttoken.id==="(end)"||nexttoken.id==="}")return true;advance()}}];cssBorderStyle=["none","hidden","dotted","dashed","solid","double","ridge","inset","outset"];cssBreak=["auto","always","avoid","left","right"];cssOverflow=["auto","hidden","scroll","visible"];cssAttributeData={background:[true,"background-attachment","background-color","background-image","background-position","background-repeat"],"background-attachment":["scroll","fixed"],"background-color":["transparent",
cssColor],"background-image":["none",cssUrl],"background-position":[2,[cssLength,"top","bottom","left","right","center"]],"background-repeat":["repeat","repeat-x","repeat-y","no-repeat"],border:[true,"border-color","border-style","border-width"],"border-bottom":[true,"border-bottom-color","border-bottom-style","border-bottom-width"],"border-bottom-color":cssColor,"border-bottom-style":cssBorderStyle,"border-bottom-width":cssWidth,"border-collapse":["collapse","separate"],"border-color":["transparent",
4,cssColor],"border-left":[true,"border-left-color","border-left-style","border-left-width"],"border-left-color":cssColor,"border-left-style":cssBorderStyle,"border-left-width":cssWidth,"border-right":[true,"border-right-color","border-right-style","border-right-width"],"border-right-color":cssColor,"border-right-style":cssBorderStyle,"border-right-width":cssWidth,"border-spacing":[2,cssLength],"border-style":[4,cssBorderStyle],"border-top":[true,"border-top-color","border-top-style","border-top-width"],
"border-top-color":cssColor,"border-top-style":cssBorderStyle,"border-top-width":cssWidth,"border-width":[4,cssWidth],bottom:[cssLength,"auto"],"caption-side":["bottom","left","right","top"],clear:["both","left","none","right"],clip:[cssShape,"auto"],color:cssColor,content:["open-quote","close-quote","no-open-quote","no-close-quote",cssString,cssUrl,cssCounter,cssAttr],"counter-increment":[cssName,"none"],"counter-reset":[cssName,"none"],cursor:[cssUrl,"auto","crosshair","default","e-resize","help",
"move","n-resize","ne-resize","nw-resize","pointer","s-resize","se-resize","sw-resize","w-resize","text","wait"],direction:["ltr","rtl"],display:["block","compact","inline","inline-block","inline-table","list-item","marker","none","run-in","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],"empty-cells":["show","hide"],"float":["left","none","right"],font:["caption","icon","menu","message-box","small-caption",
"status-bar",true,"font-size","font-style","font-weight","font-family"],"font-family":cssCommaList,"font-size":["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller",cssLength],"font-size-adjust":["none",cssNumber],"font-stretch":["normal","wider","narrower","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded"],"font-style":["normal","italic","oblique"],"font-variant":["normal","small-caps"],"font-weight":["normal",
"bold","bolder","lighter",cssNumber],height:[cssLength,"auto"],left:[cssLength,"auto"],"letter-spacing":["normal",cssLength],"line-height":["normal",cssLineHeight],"list-style":[true,"list-style-image","list-style-position","list-style-type"],"list-style-image":["none",cssUrl],"list-style-position":["inside","outside"],"list-style-type":["circle","disc","square","decimal","decimal-leading-zero","lower-roman","upper-roman","lower-greek","lower-alpha","lower-latin","upper-alpha","upper-latin","hebrew",
"katakana","hiragana-iroha","katakana-oroha","none"],margin:[4,cssMargin],"margin-bottom":cssMargin,"margin-left":cssMargin,"margin-right":cssMargin,"margin-top":cssMargin,"marker-offset":[cssLength,"auto"],"max-height":[cssLength,"none"],"max-width":[cssLength,"none"],"min-height":cssLength,"min-width":cssLength,opacity:cssNumber,outline:[true,"outline-color","outline-style","outline-width"],"outline-color":["invert",cssColor],"outline-style":["dashed","dotted","double","groove","inset","none","outset",
"ridge","solid"],"outline-width":cssWidth,overflow:cssOverflow,"overflow-x":cssOverflow,"overflow-y":cssOverflow,padding:[4,cssLength],"padding-bottom":cssLength,"padding-left":cssLength,"padding-right":cssLength,"padding-top":cssLength,"page-break-after":cssBreak,"page-break-before":cssBreak,position:["absolute","fixed","relative","static"],quotes:[8,cssString],right:[cssLength,"auto"],"table-layout":["auto","fixed"],"text-align":["center","justify","left","right"],"text-decoration":["none","underline",
"overline","line-through","blink"],"text-indent":cssLength,"text-shadow":["none",4,[cssColor,cssLength]],"text-transform":["capitalize","uppercase","lowercase","none"],top:[cssLength,"auto"],"unicode-bidi":["normal","embed","bidi-override"],"vertical-align":["baseline","bottom","sub","super","top","text-top","middle","text-bottom",cssLength],visibility:["visible","hidden","collapse"],"white-space":["normal","nowrap","pre","pre-line","pre-wrap","inherit"],width:[cssLength,"auto"],"word-spacing":["normal",
cssLength],"word-wrap":["break-word","normal"],"z-index":["auto",cssNumber]};function styleAttribute(){var v;while(nexttoken.id==="*"||nexttoken.id==="#"||nexttoken.value==="_"){if(!option.css)warning("Unexpected '{a}'.",nexttoken,nexttoken.value);advance()}if(nexttoken.id==="-"){if(!option.css)warning("Unexpected '{a}'.",nexttoken,nexttoken.value);advance("-");if(!nexttoken.identifier)warning("Expected a non-standard style attribute and instead saw '{a}'.",nexttoken,nexttoken.value);advance();return cssAny}else{if(!nexttoken.identifier)warning("Excepted a style attribute, and instead saw '{a}'.",
nexttoken,nexttoken.value);else if(is_own(cssAttributeData,nexttoken.value))v=cssAttributeData[nexttoken.value];else{v=cssAny;if(!option.css)warning("Unrecognized style attribute '{a}'.",nexttoken,nexttoken.value)}advance();return v}}function styleValue(v){var i=0,n,once,match,round,start=0,vi;switch(typeof v){case "function":return v();case "string":if(nexttoken.identifier&&nexttoken.value===v){advance();return true}return false}for(;;){if(i>=v.length)return false;vi=v[i];i+=1;if(vi===true)break;
else if(typeof vi==="number"){n=vi;vi=v[i];i+=1}else n=1;match=false;while(n>0)if(styleValue(vi)){match=true;n-=1}else break;if(match)return true}start=i;once=[];for(;;){round=false;for(i=start;i<v.length;i+=1)if(!once[i])if(styleValue(cssAttributeData[v[i]])){match=true;round=true;once[i]=true;break}if(!round)return match}}function styleChild(){if(nexttoken.id==="(number)"){advance();if(nexttoken.value==="n"&&nexttoken.identifier){adjacent();advance();if(nexttoken.id==="+"){adjacent();advance("+");
adjacent();advance("(number)")}}return}else switch(nexttoken.value){case "odd":case "even":if(nexttoken.identifier){advance();return}}warning("Unexpected token '{a}'.",nexttoken,nexttoken.value)}function substyle(){var v;for(;;){if(nexttoken.id==="}"||nexttoken.id==="(end)"||xquote&&nexttoken.id===xquote)return;while(nexttoken.id===";"){warning("Misplaced ';'.");advance(";")}v=styleAttribute();advance(":");if(nexttoken.identifier&&nexttoken.value==="inherit")advance();else if(!styleValue(v)){warning("Unexpected token '{a}'.",
nexttoken,nexttoken.value);advance()}if(nexttoken.id==="!"){advance("!");adjacent();if(nexttoken.identifier&&nexttoken.value==="important")advance();else warning("Expected '{a}' and instead saw '{b}'.",nexttoken,"important",nexttoken.value)}if(nexttoken.id==="}"||nexttoken.id===xquote)warning("Missing '{a}'.",nexttoken,";");else advance(";")}}function styleSelector(){if(nexttoken.identifier){if(!is_own(htmltag,nexttoken.value))warning("Expected a tagName, and instead saw {a}.",nexttoken,nexttoken.value);
advance()}else switch(nexttoken.id){case ">":case "+":advance();styleSelector();break;case ":":advance(":");switch(nexttoken.value){case "active":case "after":case "before":case "checked":case "disabled":case "empty":case "enabled":case "first-child":case "first-letter":case "first-line":case "first-of-type":case "focus":case "hover":case "last-of-type":case "link":case "only-of-type":case "root":case "target":case "visited":advance();break;case "lang":advance();advance("(");if(!nexttoken.identifier)warning("Expected a lang code, and instead saw :{a}.",
nexttoken,nexttoken.value);advance(")");break;case "nth-child":case "nth-last-child":case "nth-last-of-type":case "nth-of-type":advance();advance("(");styleChild();advance(")");break;case "not":advance();advance("(");if(nexttoken.id===":"&&peek(0).value==="not")warning("Nested not.");styleSelector();advance(")");break;default:warning("Expected a pseudo, and instead saw :{a}.",nexttoken,nexttoken.value)}break;case "#":advance("#");if(!nexttoken.identifier)warning("Expected an id, and instead saw #{a}.",
nexttoken,nexttoken.value);advance();break;case "*":advance("*");break;case ".":advance(".");if(!nexttoken.identifier)warning("Expected a class, and instead saw #.{a}.",nexttoken,nexttoken.value);advance();break;case "[":advance("[");if(!nexttoken.identifier)warning("Expected an attribute, and instead saw [{a}].",nexttoken,nexttoken.value);advance();if(nexttoken.id==="="||nexttoken.value==="~="||nexttoken.value==="$="||nexttoken.value==="|="||nexttoken.id==="*="||nexttoken.id==="^="){advance();if(nexttoken.type!==
"(string)")warning("Expected a string, and instead saw {a}.",nexttoken,nexttoken.value);advance()}advance("]");break;default:error("Expected a CSS selector, and instead saw {a}.",nexttoken,nexttoken.value)}}function stylePattern(){var name;if(nexttoken.id==="{")warning("Expected a style pattern, and instead saw '{a}'.",nexttoken,nexttoken.id);else if(nexttoken.id==="@"){advance("@");name=nexttoken.value;if(nexttoken.identifier&&atrule[name]===true){advance();return name}warning("Expected an at-rule, and instead saw @{a}.",
nexttoken,name)}for(;;){styleSelector();if(nexttoken.id==="</"||nexttoken.id==="{"||nexttoken.id==="(end)")return"";if(nexttoken.id===",")comma()}}function styles(){var i;while(nexttoken.id==="@"){i=peek();if(i.identifier&&i.value==="import"){advance("@");advance();if(!cssUrl()){warning("Expected '{a}' and instead saw '{b}'.",nexttoken,"url",nexttoken.value);advance()}advance(";")}else break}while(nexttoken.id!=="</"&&nexttoken.id!=="(end)"){stylePattern();xmode="styleproperty";if(nexttoken.id===
";")advance(";");else{advance("{");substyle();xmode="style";advance("}")}}}function doBegin(n){if(n!=="html"&&!option.fragment)if(n==="div"&&option.adsafe)error("ADSAFE: Use the fragment option.");else error("Expected '{a}' and instead saw '{b}'.",token,"html",n);if(option.adsafe){if(n==="html")error("Currently, ADsafe does not operate on whole HTML documents. It operates on <div> fragments and .js files.",token);if(option.fragment){if(n!=="div")error("ADsafe violation: Wrap the widget in a div.",
token)}else error("Use the fragment option.",token)}option.browser=true;assume()}function doAttribute(n,a,v){var u,x;if(a==="id"){u=typeof v==="string"?v.toUpperCase():"";if(ids[u]===true)warning("Duplicate id='{a}'.",nexttoken,v);if(!/^[A-Za-z][A-Za-z0-9._:\-]*$/.test(v))warning("Bad id: '{a}'.",nexttoken,v);else if(option.adsafe)if(adsafe_id)if(v.slice(0,adsafe_id.length)!==adsafe_id)warning("ADsafe violation: An id must have a '{a}' prefix",nexttoken,adsafe_id);else{if(!/^[A-Z]+_[A-Z]+$/.test(v))warning("ADSAFE violation: bad id.")}else{adsafe_id=
v;if(!/^[A-Z]+_$/.test(v))warning("ADSAFE violation: bad id.")}x=v.search(dx);if(x>=0)warning("Unexpected character '{a}' in {b}.",token,v.charAt(x),a);ids[u]=true}else if(a==="class"||a==="type"||a==="name"){x=v.search(qx);if(x>=0)warning("Unexpected character '{a}' in {b}.",token,v.charAt(x),a);ids[u]=true}else if(a==="href"||a==="background"||a==="content"||a==="data"||a.indexOf("src")>=0||a.indexOf("url")>=0){if(option.safe&&ux.test(v))error("ADsafe URL violation.");urls.push(v)}else if(a==="for"){if(option.adsafe)if(adsafe_id)if(v.slice(0,
adsafe_id.length)!==adsafe_id)warning("ADsafe violation: An id must have a '{a}' prefix",nexttoken,adsafe_id);else{if(!/^[A-Z]+_[A-Z]+$/.test(v))warning("ADSAFE violation: bad id.")}else warning("ADSAFE violation: bad id.")}else if(a==="name")if(option.adsafe&&v.indexOf("_")>=0)warning("ADsafe name violation.")}function doTag(n,a){var i,t=htmltag[n],x;src=false;if(!t)error("Unrecognized tag '<{a}>'.",nexttoken,n===n.toLowerCase()?n:n+" (capitalization error)");if(stack.length>0){if(n==="html")error("Too many <html> tags.",
token);x=t.parent;if(x){if(x.indexOf(" "+stack[stack.length-1].name+" ")<0)error("A '<{a}>' must be within '<{b}>'.",token,n,x)}else if(!option.adsafe&&!option.fragment){i=stack.length;do{if(i<=0)error("A '<{a}>' must be within '<{b}>'.",token,n,"body");i-=1}while(stack[i].name!=="body")}}switch(n){case "div":if(option.adsafe&&stack.length===1&&!adsafe_id)warning("ADSAFE violation: missing ID_.");break;case "script":xmode="script";advance(">");indent=nexttoken.from;if(a.lang)warning("lang is deprecated.",
token);if(option.adsafe&&stack.length!==1)warning("ADsafe script placement violation.",token);if(a.src){if(option.adsafe&&(!adsafe_may||!approved[a.src]))warning("ADsafe unapproved script source.",token);if(a.type)warning("type is unnecessary.",token)}else{if(adsafe_went)error("ADsafe script violation.",token);statements("script")}xmode="html";advance("</");if(!nexttoken.identifier&&nexttoken.value!=="script")warning("Expected '{a}' and instead saw '{b}'.",nexttoken,"script",nexttoken.value);advance();
xmode="outer";break;case "style":xmode="style";advance(">");styles();xmode="html";advance("</");if(!nexttoken.identifier&&nexttoken.value!=="style")warning("Expected '{a}' and instead saw '{b}'.",nexttoken,"style",nexttoken.value);advance();xmode="outer";break;case "input":switch(a.type){case "radio":case "checkbox":case "button":case "reset":case "submit":break;case "text":case "file":case "password":case "file":case "hidden":case "image":if(option.adsafe&&a.autocomplete!=="off")warning("ADsafe autocomplete violation.");
break;default:warning("Bad input type.")}break;case "applet":case "body":case "embed":case "frame":case "frameset":case "head":case "iframe":case "noembed":case "noframes":case "object":case "param":if(option.adsafe)warning("ADsafe violation: Disallowed tag: "+n);break}}function closetag(n){return"</"+n+">"}function html(){var a,attributes,e,n,q,t,v,w=option.white,wmode;xmode="html";xquote="";stack=null;for(;;){switch(nexttoken.value){case "<":xmode="html";advance("<");attributes={};t=nexttoken;if(!t.identifier)warning("Bad identifier {a}.",
t,t.value);n=t.value;if(option.cap)n=n.toLowerCase();t.name=n;advance();if(!stack){stack=[];doBegin(n)}v=htmltag[n];if(typeof v!=="object")error("Unrecognized tag '<{a}>'.",t,n);e=v.empty;t.type=n;for(;;){if(nexttoken.id==="/"){advance("/");if(nexttoken.id!==">")warning("Expected '{a}' and instead saw '{b}'.",nexttoken,">",nexttoken.value);break}if(nexttoken.id&&nexttoken.id.substr(0,1)===">")break;if(!nexttoken.identifier){if(nexttoken.id==="(end)"||nexttoken.id==="(error)")error("Missing '>'.",
nexttoken);warning("Bad identifier.")}option.white=true;nonadjacent(token,nexttoken);a=nexttoken.value;option.white=w;advance();if(!option.cap&&a!==a.toLowerCase())warning("Attribute '{a}' not all lower case.",nexttoken,a);a=a.toLowerCase();xquote="";if(is_own(attributes,a))warning("Attribute '{a}' repeated.",nexttoken,a);if(a.slice(0,2)==="on"){if(!option.on)warning("Avoid HTML event handlers.");xmode="scriptstring";advance("=");q=nexttoken.id;if(q!=='"'&&q!=="'")error("Missing quote.");xquote=q;
wmode=option.white;option.white=false;advance(q);statements("on");option.white=wmode;if(nexttoken.id!==q)error("Missing close quote on script attribute.");xmode="html";xquote="";advance(q);v=false}else if(a==="style"){xmode="scriptstring";advance("=");q=nexttoken.id;if(q!=='"'&&q!=="'")error("Missing quote.");xmode="styleproperty";xquote=q;advance(q);substyle();xmode="html";xquote="";advance(q);v=false}else if(nexttoken.id==="="){advance("=");v=nexttoken.value;if(!nexttoken.identifier&&nexttoken.id!==
'"'&&nexttoken.id!=="'"&&nexttoken.type!=="(string)"&&nexttoken.type!=="(number)"&&nexttoken.type!=="(color)")warning("Expected an attribute value and instead saw '{a}'.",token,a);advance()}else v=true;attributes[a]=v;doAttribute(n,a,v)}doTag(n,attributes);if(!e)stack.push(t);xmode="outer";advance(">");break;case "</":xmode="html";advance("</");if(!nexttoken.identifier)warning("Bad identifier.");n=nexttoken.value;if(option.cap)n=n.toLowerCase();advance();if(!stack)error("Unexpected '{a}'.",nexttoken,
closetag(n));t=stack.pop();if(!t)error("Unexpected '{a}'.",nexttoken,closetag(n));if(t.name!==n)error("Expected '{a}' and instead saw '{b}'.",nexttoken,closetag(t.name),closetag(n));if(nexttoken.id!==">")error("Missing '{a}'.",nexttoken,">");xmode="outer";advance(">");break;case "<!":if(option.safe)warning("ADsafe HTML violation.");xmode="html";for(;;){advance();if(nexttoken.id===">"||nexttoken.id==="(end)")break;if(nexttoken.value.indexOf("--")>=0)warning("Unexpected --.");if(nexttoken.value.indexOf("<")>=
0)warning("Unexpected <.");if(nexttoken.value.indexOf(">")>=0)warning("Unexpected >.")}xmode="outer";advance(">");break;case "(end)":return;default:if(nexttoken.id==="(end)")error("Missing '{a}'.",nexttoken,"</"+stack[stack.length-1].value+">");else advance()}if(stack&&stack.length===0&&(option.adsafe||!option.fragment||nexttoken.id==="(end)"))break}if(nexttoken.id!=="(end)")error("Unexpected material after the end.")}type("(number)",idValue);type("(string)",idValue);syntax["(identifier)"]={type:"(identifier)",
lbp:0,identifier:true,nud:function(){var v=this.value,s=scope[v],f;if(typeof s==="function")s=undefined;else if(typeof s==="boolean"){f=funct;funct=functions[0];addlabel(v,"var");s=funct;funct=f}if(funct===s)switch(funct[v]){case "unused":funct[v]="var";break;case "label":warning("'{a}' is a statement label.",token,v);break}else if(funct["(global)"]){if(option.undef&&predefined[v]!=="boolean")warning("'{a}' is not defined.",token,v);note_implied(token)}else switch(funct[v]){case "closure":case "function":case "var":case "unused":warning("'{a}' used out of scope.",
token,v);break;case "label":warning("'{a}' is a statement label.",token,v);break;case "outer":case "global":break;default:if(s===true)funct[v]=true;else if(s===null){warning("'{a}' is not allowed.",token,v);note_implied(token)}else if(typeof s!=="object"){if(option.undef)warning("'{a}' is not defined.",token,v);else funct[v]=true;note_implied(token)}else switch(s[v]){case "function":case "var":case "unused":s[v]="closure";funct[v]=s["(global)"]?"global":"outer";break;case "closure":case "parameter":funct[v]=
s["(global)"]?"global":"outer";break;case "label":warning("'{a}' is a statement label.",token,v)}}return this},led:function(){error("Expected an operator and instead saw '{a}'.",nexttoken,nexttoken.value)}};type("(regexp)",function(){return this});delim("(endline)");delim("(begin)");delim("(end)").reach=true;delim("</").reach=true;delim("<!");delim("<!--");delim("--\>");delim("(error)").reach=true;delim("}").reach=true;delim(")");delim("]");delim('"').reach=true;delim("'").reach=true;delim(";");delim(":").reach=
true;delim(",");delim("#");delim("@");reserve("else");reserve("case").reach=true;reserve("catch");reserve("default").reach=true;reserve("finally");reservevar("arguments");reservevar("eval");reservevar("false");reservevar("Infinity");reservevar("NaN");reservevar("null");reservevar("this");reservevar("true");reservevar("undefined");assignop("=","assign",20);assignop("+=","assignadd",20);assignop("-=","assignsub",20);assignop("*=","assignmult",20);assignop("/=","assigndiv",20).nud=function(){error("A regular expression literal can be confused with '/='.")};
assignop("%=","assignmod",20);bitwiseassignop("&=","assignbitand",20);bitwiseassignop("|=","assignbitor",20);bitwiseassignop("^=","assignbitxor",20);bitwiseassignop("<<=","assignshiftleft",20);bitwiseassignop(">>=","assignshiftright",20);bitwiseassignop(">>>=","assignshiftrightunsigned",20);infix("?",function(left,that){that.left=left;that.right=parse(10);advance(":");that["else"]=parse(10);return that},30);infix("||","or",40);infix("&&","and",50);bitwise("|","bitor",70);bitwise("^","bitxor",80);
bitwise("&","bitand",90);relation("==",function(left,right){if(option.eqeqeq)warning("Expected '{a}' and instead saw '{b}'.",this,"===","==");else if(isPoorRelation(left))warning("Use '{a}' to compare with '{b}'.",this,"===",left.value);else if(isPoorRelation(right))warning("Use '{a}' to compare with '{b}'.",this,"===",right.value);return this});relation("===");relation("!=",function(left,right){if(option.eqeqeq)warning("Expected '{a}' and instead saw '{b}'.",this,"!==","!=");else if(isPoorRelation(left))warning("Use '{a}' to compare with '{b}'.",
this,"!==",left.value);else if(isPoorRelation(right))warning("Use '{a}' to compare with '{b}'.",this,"!==",right.value);return this});relation("!==");relation("<");relation(">");relation("<=");relation(">=");bitwise("<<","shiftleft",120);bitwise(">>","shiftright",120);bitwise(">>>","shiftrightunsigned",120);infix("in","in",120);infix("instanceof","instanceof",120);infix("+",function(left,that){var right=parse(130);if(left&&right&&left.id==="(string)"&&right.id==="(string)"){left.value+=right.value;
left.character=right.character;if(jx.test(left.value))warning("JavaScript URL.",left);return left}that.left=left;that.right=right;return that},130);prefix("+","num");infix("-","sub",130);prefix("-","neg");infix("*","mult",140);infix("/","div",140);infix("%","mod",140);suffix("++","postinc");prefix("++","preinc");syntax["++"].exps=true;suffix("--","postdec");prefix("--","predec");syntax["--"].exps=true;prefix("delete",function(){var p=parse(0);if(!p||p.id!=="."&&p.id!=="[")warning("Expected '{a}' and instead saw '{b}'.",
nexttoken,".",nexttoken.value);this.first=p;return this}).exps=true;prefix("~",function(){if(option.bitwise)warning("Unexpected '{a}'.",this,"~");parse(150);return this});prefix("!",function(){this.right=parse(150);this.arity="unary";if(bang[this.right.id]===true)warning("Confusing use of '{a}'.",this,"!");return this});prefix("typeof","typeof");prefix("new",function(){var c=parse(155),i;if(c&&c.id!=="function")if(c.identifier){c["new"]=true;switch(c.value){case "Object":warning("Use the object literal notation {}.",
token);break;case "Array":if(nexttoken.id!=="(")warning("Use the array literal notation [].",token);else{advance("(");if(nexttoken.id===")")warning("Use the array literal notation [].",token);else{i=parse(0);c.dimension=i;if(i.id==="(number)"&&/[.+\-Ee]/.test(i.value)||i.id==="-"&&!i.right||i.id==="(string)"||i.id==="["||i.id==="{"||i.id==="true"||i.id==="false"||i.id==="null"||i.id==="undefined"||i.id==="Infinity")warning("Use the array literal notation [].",token);if(nexttoken.id!==")")error("Use the array literal notation [].",
token)}advance(")")}this.first=c;return this;case "Number":case "String":case "Boolean":case "Math":case "JSON":warning("Do not use {a} as a constructor.",token,c.value);break;case "Function":if(!option.evil)warning("The Function constructor is eval.");break;case "Date":case "RegExp":break;default:if(c.id!=="function"){i=c.value.substr(0,1);if(option.newcap&&(i<"A"||i>"Z"))warning("A constructor name should start with an uppercase letter.",token)}}}else{if(c.id!=="."&&c.id!=="["&&c.id!=="(")warning("Bad constructor.",
token)}else warning("Weird construction. Delete 'new'.",this);adjacent(token,nexttoken);if(nexttoken.id!=="(")warning("Missing '()' invoking a constructor.");this.first=c;return this});syntax["new"].exps=true;infix(".",function(left,that){adjacent(prevtoken,token);var m=identifier();if(typeof m==="string")countMember(m);that.left=left;that.right=m;if(!option.evil&&left&&left.value==="document"&&(m==="write"||m==="writeln"))warning("document.write can be a form of eval.",left);else if(option.adsafe)if(left&&
left.value==="ADSAFE")if(m==="id"||m==="lib")warning("ADsafe violation.",that);else if(m==="go"){if(xmode!=="script")warning("ADsafe violation.",that);else if(adsafe_went||nexttoken.id!=="("||peek(0).id!=="(string)"||peek(0).value!==adsafe_id||peek(1).id!==",")error("ADsafe violation: go.",that);adsafe_went=true;adsafe_may=false}if(!option.evil&&(m==="eval"||m==="execScript"))warning("eval is evil.");else if(option.safe)for(;;){if(banned[m]===true)warning("ADsafe restricted word '{a}'.",token,m);
if(typeof predefined[left.value]!=="boolean"||nexttoken.id==="(")break;if(standard_member[m]===true){if(nexttoken.id===".")warning("ADsafe violation.",that);break}if(nexttoken.id!=="."){warning("ADsafe violation.",that);break}advance(".");token.left=that;token.right=m;that=token;m=identifier();if(typeof m==="string")countMember(m)}return that},160,true);infix("(",function(left,that){adjacent(prevtoken,token);nospace();var n=0,p=[];if(left)if(left.type==="(identifier)"){if(left.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/))if(left.value!==
"Number"&&left.value!=="String"&&left.value!=="Boolean"&&left.value!=="Date")if(left.value==="Math")warning("Math is not a function.",left);else if(option.newcap)warning("Missing 'new' prefix when invoking a constructor.",left)}else if(left.id===".")if(option.safe&&left.left.value==="Math"&&left.right==="random")warning("ADsafe violation.",left);if(nexttoken.id!==")")for(;;){p[p.length]=parse(10);n+=1;if(nexttoken.id!==",")break;comma()}advance(")");if(option.immed&&left.id==="function"&&nexttoken.id!==
")")warning("Wrap the entire immediate function invocation in parens.",that);nospace(prevtoken,token);if(typeof left==="object"){if(left.value==="parseInt"&&n===1)warning("Missing radix parameter.",left);if(!option.evil)if(left.value==="eval"||left.value==="Function"||left.value==="execScript")warning("eval is evil.",left);else if(p[0]&&p[0].id==="(string)"&&(left.value==="setTimeout"||left.value==="setInterval"))warning("Implied eval is evil. Pass a function instead of a string.",left);if(!left.identifier&&
left.id!=="."&&left.id!=="["&&left.id!=="("&&left.id!=="&&"&&left.id!=="||"&&left.id!=="?")warning("Bad invocation.",left)}that.left=left;return that},155,true).exps=true;prefix("(",function(){nospace();var v=parse(0);advance(")",this);nospace(prevtoken,token);if(option.immed&&v.id==="function")if(nexttoken.id==="(")warning("Move the invocation into the parens that contain the function.",nexttoken);else warning("Do not wrap function literals in parens unless they are to be immediately invoked.",this);
return v});infix("[",function(left,that){nospace();var e=parse(0),s;if(e&&e.type==="(string)"){if(option.safe&&banned[e.value]===true)warning("ADsafe restricted word '{a}'.",that,e.value);else if(!option.evil&&(e.value==="eval"||e.value==="execScript"))warning("eval is evil.",that);else if(option.safe&&(e.value.charAt(0)==="_"||e.value.charAt(0)==="-"))warning("ADsafe restricted subscript '{a}'.",that,e.value);countMember(e.value);if(!option.sub&&ix.test(e.value)){s=syntax[e.value];if(!s||!s.reserved)warning("['{a}'] is better written in dot notation.",
e,e.value)}}else if(!e||e.type!=="(number)"||e.value<0)if(option.safe)warning("ADsafe subscripting.");advance("]",that);nospace(prevtoken,token);that.left=left;that.right=e;return that},160,true);prefix("[",function(){var b=token.line!==nexttoken.line;this.first=[];if(b){indent+=option.indent;if(nexttoken.from===indent+option.indent)indent+=option.indent}while(nexttoken.id!=="(end)"){while(nexttoken.id===","){warning("Extra comma.");advance(",")}if(nexttoken.id==="]")break;if(b&&token.line!==nexttoken.line)indentation();
this.first.push(parse(10));if(nexttoken.id===","){comma();if(nexttoken.id==="]"&&!option.es5){warning("Extra comma.",token);break}}else break}if(b){indent-=option.indent;indentation()}advance("]",this);return this},160);function property_name(){var i=optionalidentifier(true);if(!i)if(nexttoken.id==="(string)"){i=nexttoken.value;advance()}else if(nexttoken.id==="(number)"){i=nexttoken.value.toString();advance()}return i}function functionparams(){var i,t=nexttoken,p=[];advance("(");nospace();if(nexttoken.id===
")"){advance(")");nospace(prevtoken,token);return}for(;;){i=identifier();p.push(i);addlabel(i,"parameter");if(nexttoken.id===",")comma();else{advance(")",t);nospace(prevtoken,token);return p}}}function doFunction(i){var f,s=scope;scope=Object.create(s);funct={"(name)":i||'"'+anonname+'"',"(line)":nexttoken.line,"(context)":funct,"(breakage)":0,"(loopage)":0,"(scope)":scope};f=funct;token.funct=funct;functions.push(funct);if(i)addlabel(i,"function");funct["(params)"]=functionparams();block(false);
scope=s;funct["(last)"]=token.line;funct=funct["(context)"];return f}(function(x){x.nud=function(){var b,f,i,j,p,seen={},t;b=token.line!==nexttoken.line;if(b){indent+=option.indent;if(nexttoken.from===indent+option.indent)indent+=option.indent}for(;;){if(nexttoken.id==="}")break;if(b)indentation();if(nexttoken.value==="get"&&peek().id!==":"){advance("get");if(!option.es5)error("get/set are ES5 features.");i=property_name();if(!i)error("Missing property name.");t=nexttoken;adjacent(token,nexttoken);
f=doFunction(i);if(funct["(loopage)"])warning("Don't make functions within a loop.",t);p=f["(params)"];if(p)warning("Unexpected parameter '{a}' in get {b} function.",t,p[0],i);adjacent(token,nexttoken);advance(",");indentation();advance("set");j=property_name();if(i!==j)error("Expected {a} and instead saw {b}.",token,i,j);t=nexttoken;adjacent(token,nexttoken);f=doFunction(i);p=f["(params)"];if(!p||p.length!==1||p[0]!=="value")warning("Expected (value) in set {a} function.",t,i)}else{i=property_name();
if(typeof i!=="string")break;advance(":");nonadjacent(token,nexttoken);parse(10)}if(seen[i]===true)warning("Duplicate member '{a}'.",nexttoken,i);seen[i]=true;countMember(i);if(nexttoken.id===","){comma();if(nexttoken.id===",")warning("Extra comma.",token);else if(nexttoken.id==="}"&&!option.es5)warning("Extra comma.",token)}else break}if(b){indent-=option.indent;indentation()}advance("}",this);return this};x.fud=function(){error("Expected to see a statement and instead saw a block.",token)}})(delim("{"));
function varstatement(prefix){var id,name,value;if(funct["(onevar)"]&&option.onevar)warning("Too many var statements.");else if(!funct["(global)"])funct["(onevar)"]=true;this.first=[];for(;;){nonadjacent(token,nexttoken);id=identifier();if(funct["(global)"]&&predefined[id]===false)warning("Redefinition of '{a}'.",token,id);addlabel(id,"unused");if(prefix)break;name=token;this.first.push(token);if(nexttoken.id==="="){nonadjacent(token,nexttoken);advance("=");nonadjacent(token,nexttoken);if(nexttoken.id===
"undefined")warning("It is not necessary to initialize '{a}' to 'undefined'.",token,id);if(peek(0).id==="="&&nexttoken.identifier)error("Variable {a} was not declared correctly.",nexttoken,nexttoken.value);value=parse(0);name.first=value}if(nexttoken.id!==",")break;comma()}return this}stmt("var",varstatement).exps=true;blockstmt("function",function(){if(inblock)warning("Function statements cannot be placed in blocks. Use a function expression or move the statement to the top of the outer function.",
token);var i=identifier();adjacent(token,nexttoken);addlabel(i,"unused");doFunction(i);if(nexttoken.id==="("&&nexttoken.line===token.line)error("Function statements are not invocable. Wrap the whole function invocation in parens.");return this});prefix("function",function(){var i=optionalidentifier();if(i)adjacent(token,nexttoken);else nonadjacent(token,nexttoken);doFunction(i);if(funct["(loopage)"])warning("Don't make functions within a loop.");return this});blockstmt("if",function(){var t=nexttoken;
advance("(");nonadjacent(this,t);nospace();parse(20);if(nexttoken.id==="="){warning("Expected a conditional expression and instead saw an assignment.");advance("=");parse(20)}advance(")",t);nospace(prevtoken,token);block(true);if(nexttoken.id==="else"){nonadjacent(token,nexttoken);advance("else");if(nexttoken.id==="if"||nexttoken.id==="switch")statement(true);else block(true)}return this});blockstmt("try",function(){var b,e,s;if(option.adsafe)warning("ADsafe try violation.",this);block(false);if(nexttoken.id===
"catch"){advance("catch");nonadjacent(token,nexttoken);advance("(");s=scope;scope=Object.create(s);e=nexttoken.value;if(nexttoken.type!=="(identifier)")warning("Expected an identifier and instead saw '{a}'.",nexttoken,e);else addlabel(e,"exception");advance();advance(")");block(false);b=true;scope=s}if(nexttoken.id==="finally"){advance("finally");block(false);return}else if(!b)error("Expected '{a}' and instead saw '{b}'.",nexttoken,"catch",nexttoken.value);return this});blockstmt("while",function(){var t=
nexttoken;funct["(breakage)"]+=1;funct["(loopage)"]+=1;advance("(");nonadjacent(this,t);nospace();parse(20);if(nexttoken.id==="="){warning("Expected a conditional expression and instead saw an assignment.");advance("=");parse(20)}advance(")",t);nospace(prevtoken,token);block(true);funct["(breakage)"]-=1;funct["(loopage)"]-=1;return this}).labelled=true;reserve("with");blockstmt("switch",function(){var t=nexttoken,g=false;funct["(breakage)"]+=1;advance("(");nonadjacent(this,t);nospace();this.condition=
parse(20);advance(")",t);nospace(prevtoken,token);nonadjacent(token,nexttoken);t=nexttoken;advance("{");nonadjacent(token,nexttoken);indent+=option.indent;this.cases=[];for(;;)switch(nexttoken.id){case "case":switch(funct["(verb)"]){case "break":case "case":case "continue":case "return":case "switch":case "throw":break;default:warning("Expected a 'break' statement before 'case'.",token)}indentation(-option.indent);advance("case");this.cases.push(parse(20));g=true;advance(":");funct["(verb)"]="case";
break;case "default":switch(funct["(verb)"]){case "break":case "continue":case "return":case "throw":break;default:warning("Expected a 'break' statement before 'default'.",token)}indentation(-option.indent);advance("default");g=true;advance(":");break;case "}":indent-=option.indent;indentation();advance("}",t);if(this.cases.length===1||this.condition.id==="true"||this.condition.id==="false")warning("This 'switch' should be an 'if'.",this);funct["(breakage)"]-=1;funct["(verb)"]=undefined;return;case "(end)":error("Missing '{a}'.",
nexttoken,"}");return;default:if(g)switch(token.id){case ",":error("Each value should have its own case label.");return;case ":":statements();break;default:error("Missing ':' on a case clause.",token)}else error("Expected '{a}' and instead saw '{b}'.",nexttoken,"case",nexttoken.value)}}).labelled=true;stmt("debugger",function(){if(!option.debug)warning("All 'debugger' statements should be removed.");return this}).exps=true;(function(){var x=stmt("do",function(){funct["(breakage)"]+=1;funct["(loopage)"]+=
1;this.first=block(true);advance("while");var t=nexttoken;nonadjacent(token,t);advance("(");nospace();parse(20);if(nexttoken.id==="="){warning("Expected a conditional expression and instead saw an assignment.");advance("=");parse(20)}advance(")",t);nospace(prevtoken,token);funct["(breakage)"]-=1;funct["(loopage)"]-=1;return this});x.labelled=true;x.exps=true})();blockstmt("for",function(){var f=option.forin,s,t=nexttoken;funct["(breakage)"]+=1;funct["(loopage)"]+=1;advance("(");nonadjacent(this,t);
nospace();if(peek(nexttoken.id==="var"?1:0).id==="in"){if(nexttoken.id==="var"){advance("var");varstatement(true)}else{switch(funct[nexttoken.value]){case "unused":funct[nexttoken.value]="var";break;case "var":break;default:warning("Bad for in variable '{a}'.",nexttoken,nexttoken.value)}advance()}advance("in");parse(20);advance(")",t);s=block(true);if(!f&&(s.length>1||typeof s[0]!=="object"||s[0].value!=="if"))warning("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",
this);funct["(breakage)"]-=1;funct["(loopage)"]-=1;return this}else{if(nexttoken.id!==";")if(nexttoken.id==="var"){advance("var");varstatement()}else for(;;){parse(0,"for");if(nexttoken.id!==",")break;comma()}nolinebreak(token);advance(";");if(nexttoken.id!==";"){parse(20);if(nexttoken.id==="="){warning("Expected a conditional expression and instead saw an assignment.");advance("=");parse(20)}}nolinebreak(token);advance(";");if(nexttoken.id===";")error("Expected '{a}' and instead saw '{b}'.",nexttoken,
")",";");if(nexttoken.id!==")")for(;;){parse(0,"for");if(nexttoken.id!==",")break;comma()}advance(")",t);nospace(prevtoken,token);block(true);funct["(breakage)"]-=1;funct["(loopage)"]-=1;return this}}).labelled=true;stmt("break",function(){var v=nexttoken.value;if(funct["(breakage)"]===0)warning("Unexpected '{a}'.",nexttoken,this.value);nolinebreak(this);if(nexttoken.id!==";")if(token.line===nexttoken.line){if(funct[v]!=="label")warning("'{a}' is not a statement label.",nexttoken,v);else if(scope[v]!==
funct)warning("'{a}' is out of scope.",nexttoken,v);this.first=nexttoken;advance()}reachable("break");return this}).exps=true;stmt("continue",function(){var v=nexttoken.value;if(funct["(breakage)"]===0)warning("Unexpected '{a}'.",nexttoken,this.value);nolinebreak(this);if(nexttoken.id!==";"){if(token.line===nexttoken.line){if(funct[v]!=="label")warning("'{a}' is not a statement label.",nexttoken,v);else if(scope[v]!==funct)warning("'{a}' is out of scope.",nexttoken,v);this.first=nexttoken;advance()}}else if(!funct["(loopage)"])warning("Unexpected '{a}'.",
nexttoken,this.value);reachable("continue");return this}).exps=true;stmt("return",function(){nolinebreak(this);if(nexttoken.id==="(regexp)")warning("Wrap the /regexp/ literal in parens to disambiguate the slash operator.");if(nexttoken.id!==";"&&!nexttoken.reach){nonadjacent(token,nexttoken);this.first=parse(20)}reachable("return");return this}).exps=true;stmt("throw",function(){nolinebreak(this);nonadjacent(token,nexttoken);this.first=parse(20);reachable("throw");return this}).exps=true;reserve("void");
reserve("class");reserve("const");reserve("enum");reserve("export");reserve("extends");reserve("import");reserve("super");reserve("let");reserve("yield");reserve("implements");reserve("interface");reserve("package");reserve("private");reserve("protected");reserve("public");reserve("static");function jsonValue(){function jsonObject(){var o={},t=nexttoken;advance("{");if(nexttoken.id!=="}")for(;;){if(nexttoken.id==="(end)")error("Missing '}' to match '{' from line {a}.",nexttoken,t.line);else if(nexttoken.id===
"}"){warning("Unexpected comma.",token);break}else if(nexttoken.id===",")error("Unexpected comma.",nexttoken);else if(nexttoken.id!=="(string)")warning("Expected a string and instead saw {a}.",nexttoken,nexttoken.value);if(o[nexttoken.value]===true)warning("Duplicate key '{a}'.",nexttoken,nexttoken.value);else if(nexttoken.value==="__proto__")warning("Stupid key '{a}'.",nexttoken,nexttoken.value);else o[nexttoken.value]=true;advance();advance(":");jsonValue();if(nexttoken.id!==",")break;advance(",")}advance("}")}
function jsonArray(){var t=nexttoken;advance("[");if(nexttoken.id!=="]")for(;;){if(nexttoken.id==="(end)")error("Missing ']' to match '[' from line {a}.",nexttoken,t.line);else if(nexttoken.id==="]"){warning("Unexpected comma.",token);break}else if(nexttoken.id===",")error("Unexpected comma.",nexttoken);jsonValue();if(nexttoken.id!==",")break;advance(",")}advance("]")}switch(nexttoken.id){case "{":jsonObject();break;case "[":jsonArray();break;case "true":case "false":case "null":case "(number)":case "(string)":advance();
break;case "-":advance("-");if(token.character!==nexttoken.from)warning("Unexpected space after '-'.",token);adjacent(token,nexttoken);advance("(number)");break;default:error("Expected a JSON value.",nexttoken)}}var itself=function(s,o){var a,i;JSLINT.errors=[];predefined=Object.create(standard);if(o){a=o.predef;if(a instanceof Array)for(i=0;i<a.length;i+=1)predefined[a[i]]=true;if(o.adsafe)o.safe=true;if(o.safe){o.browser=false;o.css=false;o.debug=false;o.devel=false;o.eqeqeq=true;o.evil=false;o.forin=
false;o.nomen=true;o.on=false;o.rhino=false;o.safe=true;o.windows=false;o.strict=true;o.sub=false;o.undef=true;o.widget=false;predefined.Date=null;predefined["eval"]=null;predefined.Function=null;predefined.Object=null;predefined.ADSAFE=false;predefined.lib=false}option=o}else option={};option.indent=option.indent||4;option.maxerr=option.maxerr||50;adsafe_id="";adsafe_may=false;adsafe_went=false;approved={};if(option.approved)for(i=0;i<option.approved.length;i+=1)approved[option.approved[i]]=option.approved[i];
else approved.test="test";tab="";for(i=0;i<option.indent;i+=1)tab+=" ";indent=1;global=Object.create(predefined);scope=global;funct={"(global)":true,"(name)":"(global)","(scope)":scope,"(breakage)":0,"(loopage)":0};functions=[funct];ids={};urls=[];src=false;xmode=false;stack=null;member={};membersOnly=null;implied={};inblock=false;lookahead=[];jsonmode=false;warnings=0;lex.init(s);prereg=true;strict_mode=false;prevtoken=token=nexttoken=syntax["(begin)"];assume();try{advance();if(nexttoken.value.charAt(0)===
"<"){html();if(option.adsafe&&!adsafe_went)warning("ADsafe violation: Missing ADSAFE.go.",this)}else switch(nexttoken.id){case "{":case "[":option.laxbreak=true;jsonmode=true;jsonValue();break;case "@":case "*":case "#":case ".":case ":":xmode="style";advance();if(token.id!=="@"||!nexttoken.identifier||nexttoken.value!=="charset"||token.line!==1||token.from!==1)error('A css file should begin with @charset "UTF-8";');advance();if(nexttoken.type!=="(string)"&&nexttoken.value!=="UTF-8")error('A css file should begin with @charset "UTF-8";');
advance();advance(";");styles();break;default:if(option.adsafe&&option.fragment)error("Expected '{a}' and instead saw '{b}'.",nexttoken,"<div>",nexttoken.value);statements("lib")}advance("(end)")}catch(e){if(e)JSLINT.errors.push({reason:e.message,line:e.line||nexttoken.line,character:e.character||nexttoken.from},null)}return JSLINT.errors.length===0};function is_array(o){return Object.prototype.toString.apply(o)==="[object Array]"}function to_array(o){var a=[],k;for(k in o)if(is_own(o,k))a.push(k);
return a}itself.data=function(){var data={functions:[]},fu,globals,implieds=[],f,i,j,members=[],n,unused=[],v;if(itself.errors.length)data.errors=itself.errors;if(jsonmode)data.json=true;for(n in implied)if(is_own(implied,n))implieds.push({name:n,line:implied[n]});if(implieds.length>0)data.implieds=implieds;if(urls.length>0)data.urls=urls;globals=to_array(scope);if(globals.length>0)data.globals=globals;for(i=1;i<functions.length;i+=1){f=functions[i];fu={};for(j=0;j<functionicity.length;j+=1)fu[functionicity[j]]=
[];for(n in f)if(is_own(f,n)&&n.charAt(0)!=="("){v=f[n];if(is_array(fu[v])){fu[v].push(n);if(v==="unused")unused.push({name:n,line:f["(line)"],"function":f["(name)"]})}}for(j=0;j<functionicity.length;j+=1)if(fu[functionicity[j]].length===0)delete fu[functionicity[j]];fu.name=f["(name)"];fu.param=f["(params)"];fu.line=f["(line)"];fu.last=f["(last)"];data.functions.push(fu)}if(unused.length>0)data.unused=unused;members=[];for(n in member)if(typeof member[n]==="number"){data.member=member;break}return data};
itself.report=function(option){var data=itself.data();var a=[],c,e,err,f,i,k,l,m="",n,o=[],s;function detail(h,array){var b,i,singularity;if(array){o.push("<div><i>"+h+"</i> ");array=array.sort();for(i=0;i<array.length;i+=1)if(array[i]!==singularity){singularity=array[i];o.push((b?", ":"")+singularity);b=true}o.push("</div>")}}if(data.errors||data.implieds||data.unused){err=true;o.push("<div id=errors><i>Error:</i>");if(data.errors)for(i=0;i<data.errors.length;i+=1){c=data.errors[i];if(c){e=c.evidence||
"";o.push("<p>Problem"+(isFinite(c.line)?" at line "+c.line+" character "+c.character:"")+": "+c.reason.entityify()+"</p><p class=evidence>"+(e&&(e.length>80?e.slice(0,77)+"...":e).entityify())+"</p>")}}if(data.implieds){s=[];for(i=0;i<data.implieds.length;i+=1)s[i]="<code>"+data.implieds[i].name+"</code>&nbsp;<i>"+data.implieds[i].line+"</i>";o.push("<p><i>Implied global:</i> "+s.join(", ")+"</p>")}if(data.unused){s=[];for(i=0;i<data.unused.length;i+=1)s[i]="<code><u>"+data.unused[i].name+"</u></code>&nbsp;<i>"+
data.unused[i].line+"</i> <code>"+data.unused[i]["function"]+"</code>";o.push("<p><i>Unused variable:</i> "+s.join(", ")+"</p>")}if(data.json)o.push("<p>JSON: bad.</p>");o.push("</div>")}if(!option){o.push("<br><div id=functions>");if(data.urls)detail("URLs<br>",data.urls,"<br>");if(xmode==="style")o.push("<p>CSS.</p>");else if(data.json&&!err)o.push("<p>JSON: good.</p>");else if(data.globals)o.push("<div><i>Global</i> "+data.globals.sort().join(", ")+"</div>");else o.push("<div><i>No new global variables introduced.</i></div>");
for(i=0;i<data.functions.length;i+=1){f=data.functions[i];o.push("<br><div class=function><i>"+f.line+"-"+f.last+"</i> "+(f.name||"")+"("+(f.param?f.param.join(", "):"")+")</div>");detail("<big><b>Unused</b></big>",f.unused);detail("Closure",f.closure);detail("Variable",f["var"]);detail("Exception",f.exception);detail("Outer",f.outer);detail("Global",f.global);detail("Label",f.label)}if(data.member){a=to_array(data.member);if(a.length){a=a.sort();m="<br><pre id=members>/*members ";l=10;for(i=0;i<
a.length;i+=1){k=a[i];n=k.name();if(l+n.length>72){o.push(m+"<br>");m="    ";l=1}l+=n.length+2;if(data.member[k]===1)n="<i>"+n+"</i>";if(i<a.length-1)n+=", ";m+=n}o.push(m+"<br>*/</pre>")}o.push("</div>")}}return o.join("")};itself.jslint=itself;itself.edition="2010-04-06";return itself}();String.prototype.has=function(c){return this.indexOf(c)>-1};
function jsmin(comment,input,level){if(input===undefined){input=comment;comment="";level=2}else if(level===undefined||level<1||level>3)level=2;if(comment.length>0)comment+="\n";var a="",b="",EOF=-1,LETTERS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",DIGITS="0123456789",ALNUM=LETTERS+DIGITS+"_$\\",theLookahead=EOF;function isAlphanum(c){return c!=EOF&&(ALNUM.has(c)||c.charCodeAt(0)>126)}function get(){var c=theLookahead;if(get.i==get.l)return EOF;theLookahead=EOF;if(c==EOF){c=input.charAt(get.i);
++get.i}if(c>=" "||c=="\n")return c;if(c=="\r")return"\n";return" "}get.i=0;get.l=input.length;function peek(){theLookahead=get();return theLookahead}function next(){var c=get();if(c=="/")switch(peek()){case "/":for(;;){c=get();if(c<="\n")return c}break;case "*":get();if(peek()=="!"){var d="/*!";for(;;){c=get();switch(c){case "*":if(peek()=="/"){get();return d+"*/"}break;case EOF:throw"Error: Unterminated comment.";default:d+=c}}}else for(;;)switch(get()){case "*":if(peek()=="/"){get();return" "}break;
case EOF:throw"Error: Unterminated comment.";}break;default:return c}return c}function action(d){var r=[];if(d==1)r.push(a);if(d<3){a=b;if(a=="'"||a=='"')for(;;){r.push(a);a=get();if(a==b)break;if(a<="\n")throw"Error: unterminated string literal: "+a;if(a=="\\"){r.push(a);a=get()}}}b=next();if(b=="/"&&"(,=:[!&|".has(a)){r.push(a);r.push(b);for(;;){a=get();if(a=="/")break;else if(a=="\\"){r.push(a);a=get()}else if(a<="\n")throw"Error: unterminated Regular Expression literal";r.push(a)}b=next()}return r.join("")}
function m(){var r=[];a="\n";r.push(action(3));while(a!=EOF)switch(a){case " ":if(isAlphanum(b))r.push(action(1));else r.push(action(2));break;case "\n":switch(b){case "{":case "[":case "(":case "+":case "-":r.push(action(1));break;case " ":r.push(action(3));break;default:if(isAlphanum(b))r.push(action(1));else if(level==1&&b!="\n")r.push(action(1));else r.push(action(2))}break;default:switch(b){case " ":if(isAlphanum(a)){r.push(action(1));break}r.push(action(3));break;case "\n":if(level==1&&a!="\n")r.push(action(1));
else switch(a){case "}":case "]":case ")":case "+":case "-":case '"':case "'":if(level==3)r.push(action(3));else r.push(action(1));break;default:if(isAlphanum(a))r.push(action(1));else r.push(action(3))}break;default:r.push(action(1));break}}return r.join("")}jsmin.oldSize=input.length;ret=m(input);jsmin.newSize=ret.length;return comment+ret};if(!this.JSON)this.JSON={};
(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=
/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,
mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function")value=value.toJSON(key);if(typeof rep==="function")value=rep.call(holder,key,value);switch(typeof value){case "string":return quote(value);case "number":return isFinite(value)?String(value):"null";case "boolean":case "null":return String(value);case "object":if(!value)return"null";gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=
1)partial[i]=str(i,value)||"null";v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}}}else for(k in value)if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v)partial.push(quote(k)+(gap?": ":":")+v)}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+
gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function")JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number")for(i=0;i<space;i+=1)indent+=" ";else if(typeof space==="string")indent=space;rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number"))throw new Error("JSON.stringify");return str("",{"":value})};if(typeof JSON.parse!=="function")JSON.parse=
function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object")for(k in value)if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined)value[k]=v;else delete value[k]}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text))text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}})();var xmlJsonClass={xml2json:function(xml,tab,quotePropName){if(xml.nodeType===9)xml=xml.documentElement;var nws=this.removeWhite(xml);var obj=this.toObj(nws);var json=this.toJson(obj,xml.nodeName,"\t",quotePropName);return"{\n"+tab+(tab?json.replace(/\t/g,tab):json.replace(/\t|\n/g,""))+"\n}"},json2xml:function(o,tab){var toXml=function(v,name,ind){var xml="";var i,n;if(v instanceof Array)if(v.length===0)xml+=ind+"<"+name+">__EMPTY_ARRAY_</"+name+">\n";else for(i=0,n=v.length;i<n;i+=1){var sXml=ind+
toXml(v[i],name,ind+"\t")+"";xml+=sXml}else if(typeof v==="object"){var hasChild=false;xml+=ind+"<"+name;var m;for(m in v)if(v.hasOwnProperty(m))if(m.charAt(0)==="@")xml+=" "+m.substr(1)+'="'+v[m].toString()+'"';else hasChild=true;xml+=hasChild?">\n":"/>\n";if(hasChild){for(m in v)if(v.hasOwnProperty(m))if(m==="#text")xml+=v[m];else if(m==="#cdata")xml+="<![CDATA["+v[m]+"]]\>";else if(m.charAt(0)!=="@")xml+=toXml(v[m],m,ind+"\t");xml+=(xml.charAt(xml.length-1)==="\n"?ind:"")+"</"+name+">\n"}if(name==
"note")debug.trace("NOTE! == "+xml+"-")}else if(v.toString()==='""'||v.toString().length===0)xml+=ind+"<"+name+">__EMPTY_STRING_</"+name+">\n";else xml+=ind+"<"+name+">"+v.toString()+"</"+name+">\n";return xml};var xml="";var m;for(m in o)if(o.hasOwnProperty(m))xml+=toXml(o[m],m,"");return tab?xml.replace(/\t/g,tab):xml.replace(/\t|\n/g,"")},toObj:function(xml){var o={};if(xml.nodeType===1){if(xml.attributes.length){var i;for(i=0;i<xml.attributes.length;i+=1)o["@"+xml.attributes[i].nodeName]=(xml.attributes[i].nodeValue||
"").toString()}if(xml.firstChild){var textChild=0,cdataChild=0,hasElementChild=false;var n;for(n=xml.firstChild;n;n=n.nextSibling)if(n.nodeType===1)hasElementChild=true;else if(n.nodeType===3&&n.nodeValue.match(/[^ \f\n\r\t\v]/))textChild+=1;else if(n.nodeType===4)cdataChild+=1;if(hasElementChild)if(textChild<2&&cdataChild<2){this.removeWhite(xml);for(n=xml.firstChild;n;n=n.nextSibling)if(n.nodeType===3)o["#text"]=this.escape(n.nodeValue);else if(n.nodeType===4)o["#cdata"]=this.escape(n.nodeValue);
else if(o[n.nodeName])if(o[n.nodeName]instanceof Array)o[n.nodeName][o[n.nodeName].length]=this.toObj(n);else o[n.nodeName]=[o[n.nodeName],this.toObj(n)];else o[n.nodeName]=this.toObj(n)}else if(!xml.attributes.length)o=this.escape(this.innerXml(xml));else o["#text"]=this.escape(this.innerXml(xml));else if(textChild)if(!xml.attributes.length){o=this.escape(this.innerXml(xml));if(o==="__EMPTY_ARRAY_")o="[]";else if(o==="__EMPTY_STRING_")o=""}else o["#text"]=this.escape(this.innerXml(xml));else if(cdataChild)if(cdataChild>
1)o=this.escape(this.innerXml(xml));else for(n=xml.firstChild;n;n=n.nextSibling)o["#cdata"]=this.escape(n.nodeValue)}if(!xml.attributes.length&&!xml.firstChild)o=null}else if(xml.nodeType===9)o=this.toObj(xml.documentElement);else alert("unhandled node type: "+xml.nodeType);return o},toJson:function(o,name,ind,quotePropName){var json=name?(quotePropName||!validJsonKey(name)?'"':"")+name+(quotePropName||!validJsonKey(name)?'"':""):"";if(o==="[]")json+=name?":[]":"[]";else if(o instanceof Array){var n,
i;for(i=0,n=o.length;i<n;i+=1)o[i]=this.toJson(o[i],"",ind+"\t",quotePropName);json+=(name?":[":"[")+(o.length>1?"\n"+ind+"\t"+o.join(",\n"+ind+"\t")+"\n"+ind:o.join(""))+"]"}else if(o===null)json+=(name&&":")+"null";else if(typeof o==="object"){var arr=[];var m;for(m in o)if(o.hasOwnProperty(m))arr[arr.length]=this.toJson(o[m],m,ind+"\t",quotePropName);json+=(name?":{":"{")+(arr.length>1?"\n"+ind+"\t"+arr.join(",\n"+ind+"\t")+"\n"+ind:arr.join(""))+"}"}else if(typeof o==="string"){o=o.toString();
var objRegExp=/(^-?\d+\.?\d*$)/;if(objRegExp.test(o))json+=(name&&":")+o;else json+=(name&&":")+'"'+o.replace("\n","")+'"'}else json+=(name&&":")+o.toString();return json},innerXml:function(node){var s="";if("innerHTML"in node)s=node.innerHTML;else{var asXml=function(n){var s="",i;if(n.nodeType===1){s+="<"+n.nodeName;for(i=0;i<n.attributes.length;i+=1)s+=" "+n.attributes[i].nodeName+'="'+(n.attributes[i].nodeValue||"").toString()+'"';if(n.firstChild){s+=">";for(var c=n.firstChild;c;c=c.nextSibling)s+=
asXml(c);s+="</"+n.nodeName+">"}else s+="/>"}else if(n.nodeType===3)s+=n.nodeValue;else if(n.nodeType===4)s+="<![CDATA["+n.nodeValue+"]]\>";return s};for(var c=node.firstChild;c;c=c.nextSibling)s+=asXml(c)}return s},escape:function(txt){return txt.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();var n;for(n=e.firstChild;n;)if(n.nodeType===3)if(!n.nodeValue.match(/[^ \f\n\r\t\v]/)){var nxt=n.nextSibling;e.removeChild(n);
n=nxt}else n=n.nextSibling;else if(n.nodeType===1){this.removeWhite(n);n=n.nextSibling}else n=n.nextSibling;return e}};var CodeMirrorConfig=window.CodeMirrorConfig||{};
var CodeMirror=function(){function setDefaults(object,defaults){for(var option in defaults)if(!object.hasOwnProperty(option))object[option]=defaults[option]}function forEach(array,action){for(var i=0;i<array.length;i++)action(array[i])}setDefaults(CodeMirrorConfig,{stylesheet:"",path:"",parserfile:[],basefiles:["util.js","stringstream.js","select.js","undo.js","editor.js","tokenize.js"],iframeClass:null,passDelay:200,passTime:50,lineNumberDelay:200,lineNumberTime:50,continuousScanning:false,saveFunction:null,
onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:true,textWrapping:true,readOnly:false,width:"",height:"300px",autoMatchParens:false,parserConfig:null,tabMode:"indent",reindentOnLoad:false,activeTokens:null,cursorActivity:null,lineNumbers:false,indentUnit:2,domain:null});function addLineNumberDiv(container){var nums=document.createElement("DIV"),scroller=document.createElement("DIV");nums.style.position="absolute";nums.style.height="100%";if(nums.style.setExpression)try{nums.style.setExpression("height",
"this.previousSibling.offsetHeight + 'px'")}catch(e){}nums.style.top="0px";nums.style.overflow="hidden";container.appendChild(nums);scroller.className="CodeMirror-line-numbers";nums.appendChild(scroller);return nums}function frameHTML(options){if(typeof options.parserfile=="string")options.parserfile=[options.parserfile];if(typeof options.stylesheet=="string")options.stylesheet=[options.stylesheet];var html=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>'];
html.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>');forEach(options.stylesheet,function(file){html.push('<link rel="stylesheet" type="text/css" href="'+file+'"/>')});forEach(options.basefiles.concat(options.parserfile),function(file){html.push('<script type="text/javascript" src="'+options.path+file+'"><'+"/script>")});html.push('</head><body style="border-width: 0;" class="editbox" spellcheck="'+(options.disableSpellcheck?"false":"true")+'"></body></html>');return html.join("")}
var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);function CodeMirror(place,options){if(options.dumbTabs)options.tabMode="spaces";else if(options.normalTab)options.tabMode="default";this.options=options=options||{};setDefaults(options,CodeMirrorConfig);var frame=this.frame=document.createElement("IFRAME");if(options.iframeClass)frame.className=options.iframeClass;frame.frameBorder=0;frame.style.border="0";frame.style.width="100%";frame.style.height="100%";
frame.style.display="block";var div=this.wrapping=document.createElement("DIV");div.style.position="relative";div.className="CodeMirror-wrapping";div.style.width=options.width;div.style.height=options.height;var teHack=this.textareaHack=document.createElement("TEXTAREA");div.appendChild(teHack);teHack.style.position="absolute";teHack.style.left="-10000px";teHack.style.width="10px";frame.CodeMirror=this;frame.src="../../../source-"+options.lang+".html";if(place.appendChild)place.appendChild(div);else place(div);
div.appendChild(frame);if(options.lineNumbers)this.lineNumbers=addLineNumberDiv(div);this.win=frame.contentWindow;if(!options.domain||!internetExplorer){this.win.document.open();this.win.document.write(frameHTML(options));this.win.document.close()}}CodeMirror.prototype={init:function(){if(this.options.initCallback)this.options.initCallback(this);if(this.options.lineNumbers)this.activateLineNumbers();if(this.options.reindentOnLoad)this.reindent()},getCode:function(){return this.editor.getCode()},setCode:function(code){this.editor.importCode(code)},
selection:function(){this.focusIfIE();return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.focusIfIE();this.editor.reindentSelection(null)},focusIfIE:function(){if(this.win.select.ie_selection)this.focus()},focus:function(){this.win.focus();if(this.editor.selectionSnapshot)this.win.select.setBookmark(this.win.document.body,this.editor.selectionSnapshot)},replaceSelection:function(text){this.focus();this.editor.replaceSelection(text);return true},
replaceChars:function(text,start,end){this.editor.replaceChars(text,start,end)},getSearchCursor:function(string,fromCursor,caseFold){return this.editor.getSearchCursor(string,fromCursor,caseFold)},undo:function(){this.editor.history.undo()},redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(callback,filter){this.editor.grabKeys(callback,filter)},ungrabKeys:function(){this.editor.ungrabKeys()},
setParser:function(name){this.editor.setParser(name)},setSpellcheck:function(on){this.win.document.body.spellcheck=on},setStylesheet:function(names){if(typeof names==="string")names=[names];var activeStylesheets={};var matchedNames={};var links=this.win.document.getElementsByTagName("link");for(var x=0,link;link=links[x];x++)if(link.rel.indexOf("stylesheet")!==-1)for(var y=0;y<names.length;y++){var name=names[y];if(link.href.substring(link.href.length-name.length)===name){activeStylesheets[link.href]=
true;matchedNames[name]=true}}for(var x=0,link;link=links[x];x++)if(link.rel.indexOf("stylesheet")!==-1)link.disabled=!(link.href in activeStylesheets);for(var y=0;y<names.length;y++){var name=names[y];if(!(name in matchedNames)){var link=this.win.document.createElement("link");link.rel="stylesheet";link.type="text/css";link.href=name;this.win.document.getElementsByTagName("head")[0].appendChild(link)}}},setTextWrapping:function(on){if(on==this.options.textWrapping)return;this.win.document.body.style.whiteSpace=
on?"":"nowrap";this.options.textWrapping=on;if(this.lineNumbers){this.setLineNumbers(false);this.setLineNumbers(true)}},setIndentUnit:function(unit){this.win.indentUnit=unit},setUndoDepth:function(depth){this.editor.history.maxDepth=depth},setTabMode:function(mode){this.options.tabMode=mode},setLineNumbers:function(on){if(on&&!this.lineNumbers){this.lineNumbers=addLineNumberDiv(this.wrapping);this.activateLineNumbers()}else if(!on&&this.lineNumbers){this.wrapping.removeChild(this.lineNumbers);this.wrapping.style.marginLeft=
"";this.lineNumbers=null}},cursorPosition:function(start){this.focusIfIE();return this.editor.cursorPosition(start)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(line){return this.editor.nextLine(line)},prevLine:function(line){return this.editor.prevLine(line)},lineContent:function(line){return this.editor.lineContent(line)},setLineContent:function(line,content){this.editor.setLineContent(line,content)},removeLine:function(line){this.editor.removeLine(line)},
insertIntoLine:function(line,position,content){this.editor.insertIntoLine(line,position,content)},selectLines:function(startLine,startOffset,endLine,endOffset){this.win.focus();this.editor.selectLines(startLine,startOffset,endLine,endOffset)},nthLine:function(n){var line=this.firstLine();for(;n>1&&line!==false;n--)line=this.nextLine(line);return line},lineNumber:function(line){var num=0;while(line!==false){num++;line=this.prevLine(line)}return num},jumpToLine:function(line){if(typeof line=="number")line=
this.nthLine(line);this.selectLines(line,0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorLine())},cursorLine:function(){return this.cursorPosition().line},activateLineNumbers:function(){var frame=this.frame,win=frame.contentWindow,doc=win.document,body=doc.body,nums=this.lineNumbers,scroller=nums.firstChild,self=this;var barWidth=null;function sizeBar(){if(frame.offsetWidth==0)return;for(var root=frame;root.parentNode;root=root.parentNode);if(!nums.parentNode||root!=
document||!win.Editor){try{clear()}catch(e){}clearInterval(sizeInterval);return}if(nums.offsetWidth!=barWidth){barWidth=nums.offsetWidth;nums.style.left="-"+(frame.parentNode.style.marginLeft=barWidth+"px")}}function doScroll(){nums.scrollTop=body.scrollTop||doc.documentElement.scrollTop||0}var clear=function(){};sizeBar();var sizeInterval=setInterval(sizeBar,500);function nonWrapping(){var nextNum=1,pending;function update(){var target=50+Math.max(body.offsetHeight,Math.max(frame.offsetHeight,body.scrollHeight||
0));var endTime=(new Date).getTime()+self.options.lineNumberTime;while(scroller.offsetHeight<target&&(!scroller.firstChild||scroller.offsetHeight)){scroller.appendChild(document.createElement("DIV"));scroller.lastChild.innerHTML=nextNum++;if((new Date).getTime()>endTime){if(pending)clearTimeout(pending);pending=setTimeout(update,self.options.lineNumberDelay);break}}doScroll()}var onScroll=win.addEventHandler(win,"scroll",update,true),onResize=win.addEventHandler(win,"resize",update,true);clear=function(){onScroll();
onResize();if(pending)clearTimeout(pending)};update()}function wrapping(){var node,lineNum,next,pos;function addNum(n){if(!lineNum)lineNum=scroller.appendChild(document.createElement("DIV"));lineNum.innerHTML=n;pos=lineNum.offsetHeight+lineNum.offsetTop;lineNum=lineNum.nextSibling}function work(){if(!scroller.parentNode||scroller.parentNode!=self.lineNumbers)return;var endTime=(new Date).getTime()+self.options.lineNumberTime;while(node){addNum(next++);for(;node&&!win.isBR(node);node=node.nextSibling){var bott=
node.offsetTop+node.offsetHeight;while(scroller.offsetHeight&&bott-3>pos)addNum("&nbsp;")}if(node)node=node.nextSibling;if((new Date).getTime()>endTime){pending=setTimeout(work,self.options.lineNumberDelay);return}}var target=50+Math.max(body.offsetHeight,Math.max(frame.offsetHeight,body.scrollHeight||0));while(lineNum||scroller.offsetHeight<target&&(!scroller.firstChild||scroller.offsetHeight))addNum(next++);doScroll()}function start(){doScroll();node=body.firstChild;lineNum=scroller.firstChild;
pos=0;next=1;work()}start();var pending=null;function update(){if(pending)clearTimeout(pending);if(self.editor.allClean())start();else pending=setTimeout(update,200)}self.updateNumbers=update;var onScroll=win.addEventHandler(win,"scroll",doScroll,true),onResize=win.addEventHandler(win,"resize",update,true);clear=function(){if(pending)clearTimeout(pending);if(self.updateNumbers==update)self.updateNumbers=null;onScroll();onResize()}}(this.options.textWrapping?wrapping:nonWrapping)()}};CodeMirror.InvalidLineHandle=
{toString:function(){return"CodeMirror.InvalidLineHandle"}};CodeMirror.replace=function(element){if(typeof element=="string")element=document.getElementById(element);return function(newElement){element.parentNode.replaceChild(newElement,element)}};CodeMirror.fromTextArea=function(area,options){if(typeof area=="string")area=document.getElementById(area);options=options||{};if(area.style.width&&options.width==null)options.width=area.style.width;if(area.style.height&&options.height==null)options.height=
area.style.height;if(options.content==null)options.content=area.value;if(area.form){function updateField(){area.value=mirror.getCode()}if(typeof area.form.addEventListener=="function")area.form.addEventListener("submit",updateField,false);else area.form.attachEvent("onsubmit",updateField)}function insert(frame){if(area.nextSibling)area.parentNode.insertBefore(frame,area.nextSibling);else area.parentNode.appendChild(frame)}area.style.display="none";var mirror=new CodeMirror(insert,options);return mirror};
CodeMirror.isProbablySupported=function(){var match;if(window.opera)return Number(window.opera.version())>=9.52;else if(/Apple Computers, Inc/.test(navigator.vendor)&&(match=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./)))return Number(match[1])>=3;else if(document.selection&&window.ActiveXObject&&(match=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/)))return Number(match[1])>=6;else if(match=navigator.userAgent.match(/gecko\/(\d{8})/i))return Number(match[1])>=20050901;else if(match=
navigator.userAgent.match(/AppleWebKit\/(\d+)/))return Number(match[1])>=525;else return null};return CodeMirror}();Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5E3,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right")this.cls+=" x-status-right";Ext.ux.StatusBar.superclass.initComponent.call(this)},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var right=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+
(this.currIconCls||""),text:this.text||this.defaultText||""});if(right){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}this.doLayout()},setStatus:function(o){o=o||{};if(typeof o=="string")o={text:o};if(o.text!==undefined)this.setText(o.text);if(o.iconCls!==undefined)this.setIcon(o.iconCls);if(o.clear){var c=o.clear,wait=this.autoClear,defaults={useDefaults:true,anim:true};if(typeof c=="object"){c=Ext.applyIf(c,defaults);if(c.wait)wait=c.wait}else if(typeof c==
"number"){wait=c;c=defaults}else if(typeof c=="boolean")c=defaults;c.threadId=this.activeThreadId;this.clearStatus.defer(wait,this,[c])}return this},clearStatus:function(o){o=o||{};if(o.threadId&&o.threadId!==this.activeThreadId)return this;var text=o.useDefaults?this.defaultText:this.emptyText,iconCls=o.useDefaults?this.defaultIconCls?this.defaultIconCls:"":"";if(o.anim)this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:text,iconCls:iconCls});
this.statusEl.el.show()}});else{this.statusEl.hide();this.setStatus({text:text,iconCls:iconCls});this.statusEl.show()}return this},setText:function(text){this.activeThreadId++;this.text=text||"";if(this.rendered)this.statusEl.setText(this.text);return this},getText:function(){return this.text},setIcon:function(cls){this.activeThreadId++;cls=cls||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null}if(cls.length>0){this.statusEl.addClass(cls);
this.currIconCls=cls}}else this.currIconCls=cls;return this},showBusy:function(o){if(typeof o=="string")o={text:o};o=Ext.applyIf(o||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(o)}});Ext.reg("statusbar",Ext.ux.StatusBar);Ext.namespace("Ext.ux.form");
Ext.ux.form.CodeMirror=Ext.extend(Ext.form.TextArea,{language:"txt",codeMirrorHidden:false,codeMirrorPath:null,initCallBackFn:null,onResizeCallBackFn:null,initComponent:function(){if(this.codeMirrorPath===null)throw"Ext.ux.form.CodeMirror: codeMirrorPath required";this.initialized=false;Ext.ux.form.CodeMirror.superclass.initComponent.apply(this,arguments);this.addEvents("initialize");this.on({resize:function(ta,width,height){if(this.onResizeCallBackFn)this.onResizeCallBackFn(this);else{var el=Ext.select("."+
this.id,true);var lineNumbersEl=Ext.select("."+this.id+" ~ div",true);if(!width)width=ta.getWidth();if(!height)height=ta.getHeight();if(el){if(this.initialized&&!this.codeMirrorHidden&&count(lineNumbersEl.elements)>0&&width)width=width-lineNumbersEl.elements[0].getWidth();for(var i=0;i<el.elements.length;i++){if(width)el.elements[i].setWidth(width);if(height)el.elements[i].setHeight(height);lineNumbersEl.elements[i].setHeight(height)}}}},afterrender:function(){var parser,stylesheet;switch(this.language.toLowerCase()){case "json":parser=
["tokenizejson.js","parsejson.js"];stylesheet=this.codeMirrorPath+"/css/jsoncolors.css";break;case "css":parser="parsecss.js";stylesheet=this.codeMirrorPath+"/css/csscolors.css";break;case "js":parser=["tokenizejavascript.js","parsejavascript.js"];stylesheet=this.codeMirrorPath+"/css/jscolors.css";break;case "php":parser=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","../contrib/php/js/tokenizephp.js","../contrib/php/js/parsephp.js","../contrib/php/js/parsephphtmlmixed.js"];
stylesheet=[this.codeMirrorPath+"/css/xmlcolors.css",this.codeMirrorPath+"/css/jscolors.css",this.codeMirrorPath+"/css/csscolors.css",this.codeMirrorPath+"/contrib/php/css/phpcolors.css"];break;case "htm":case "html":case "xml":parser="parsexml.js";stylesheet=this.codeMirrorPath+"/css/xmlcolors.css";break;default:parser="parsedummy.js";stylesheet="";break}var me=this;(function(){me.codeEditor=new CodeMirror.fromTextArea(me.id,{parserfile:parser,stylesheet:stylesheet,path:me.codeMirrorPath+"/js/",
textWrapping:true,autoMatchParens:true,lineNumbers:true,passDelay:100,passTime:50,lineNumberDelay:1E3,lineNumberTime:50,iframeClass:"codemirror-iframe "+me.id,content:this.value,parserConfig:{json:true},lang:me.language.toLowerCase(),initCallback:function(){me.initialized=true;me.fireEvent("initialize",true);if(me.initCallBackFn!=null)me.initCallBackFn(me);if(me.codeMirrorHidden)me.hideCodeMirror()}})}).defer(100)}})},getValue:function(){if(this.initialized)if(this.codeMirrorHidden)return this.getTextareaValue();
else return this.codeEditor.getCode();return this.value},setValue:function(v){if(this.initialized)if(this.codeMirrorHidden)this.setTextareaValue(v);else this.codeEditor.setCode(v)},getTextareaValue:function(){if(!this.rendered)return this.value;var v=this.el.getValue();if(v===this.emptyText||v===undefined)v="";return v},setTextareaValue:function(v){if(this.emptyText&&this.el&&!Ext.isEmpty(v))this.el.removeClass(this.emptyClass);Ext.form.TextField.superclass.setValue.apply(this,arguments);this.applyEmptyText();
this.autoSize();return this},hideCodeMirror:function(){var me=this;var iframeEl=Ext.select("textarea#"+this.id+" + .CodeMirror-wrapping",true);var textareaEl=Ext.select("textarea#"+me.id,true);textareaEl.setVisibilityMode(Ext.Element.DISPLAY);iframeEl.setVisibilityMode(Ext.Element.DISPLAY);me.setTextareaValue(me.getValue());iframeEl.setVisible(false);textareaEl.setVisible(true);me.codeMirrorHidden=true},showCodeMirror:function(){var me=this;var iframeEl=Ext.select("textarea#"+this.id+" + .CodeMirror-wrapping",
true);var textareaEl=Ext.select("textarea#"+me.id,true);textareaEl.setVisibilityMode(Ext.Element.DISPLAY);iframeEl.setVisibilityMode(Ext.Element.DISPLAY);textareaEl.setVisible(false);iframeEl.setVisible(true);me.codeMirrorHidden=false;me.setValue(this.getTextareaValue());me.setTextareaValue("")},validate:function(){this.getValue();Ext.ux.form.CodeMirror.superclass.validate.apply(this,arguments)}});Ext.reg("ux-codemirror",Ext.ux.form.CodeMirror);NodeMouseoverPlugin=Ext.extend(Object,{init:function(tree){if(!tree.rendered){tree.on("render",function(){this.init(tree)},this);return}this.tree=tree;tree.body.on("mouseover",this.onTreeMouseover,this,{delegate:"div.x-tree-node-el"})},onTreeMouseover:function(e,t){var nodeEl=Ext.get(t);if(nodeEl){var nodeId=nodeEl.getAttributeNS("ext","tree-node-id");if(nodeId)this.tree.fireEvent("mouseover",this.tree.getNodeById(nodeId),e)}}});NodeMouseoutPlugin=Ext.extend(Object,{init:function(tree){if(!tree.rendered){tree.on("render",function(){this.init(tree)},this);return}this.tree=tree;tree.body.on("mouseout",this.onTreeMousout,this,{delegate:"div.x-tree-node-el"})},onTreeMousout:function(e,t){var nodeEl=Ext.get(t);if(nodeEl){var nodeId=nodeEl.getAttributeNS("ext","tree-node-id");if(nodeId)this.tree.fireEvent("mouseout",this.tree.getNodeById(nodeId),e)}}});/*
 application.js is licensed under the terms of the Open Source
 LGPL 3.0 license. Commercial use is permitted to the extent that the
 code/component(s) do NOT become part of another Open Source or Commercially
 licensed development library or toolkit without explicit permission.

 License details: http://www.gnu.org/licenses/lgpl.html
*/
console={log:air.Introspector?air.Introspector.Console.log:function(){}};Ext.BLANK_IMAGE_URL="core/extjs/resources/images/default/s.gif";Ext.ns("JP");Ext.onReady(function(){Ext.QuickTips.init();var viewport=new Ext.Viewport({layout:"border",id:"JPviewPort",items:[{xtype:"jp_main_top"},{xtype:"jp_main_center"},{xtype:"jp_main_bottom"}]})});debug.trace(UpdateApplication.getApplicationInfo()[2]);if(UpdateApplication.getApplicationInfo()[2]=="JSONpad-air.html")air.Introspector.Console.info();JP.constant={NODE_STRING:["<EMPTY>","<NULL>"]};JP.util={exit:function(){if(Ext.isAir)JP.util.air.exit();else JP.util.web.exit()},copyToClipboard:function(string){if(Ext.isAir)JP.util.air.copyToClipboard(string);else JP.util.web.copyToClipboard(string)},pasteFromClipboard:function(){if(Ext.isAir)return JP.util.air.pasteFromClipboard();else return JP.util.web.pasteFromClipboard()},validateJson:function(json,clear){if(!json.errorObject){debug.trace("clear?"+clear);if(clear)JP.util.clearCodeMirrorStatus();return true}else{JP.util.setCodeMirrorStatus({text:json.errorObject.length+
" error/s in JSON string. Click for details...",iconCls:"x-status-error x-status-error-detail-link",clear:false});JP.ErrorWindow.Action.init();JP.ErrorWindow.Action.window.setTitle(json.errorObject.length+" error/s found");var msg="";for(var i=0;i<json.errorObject.length;i++){msg+='<li style="list-style-type:disc; margin-left: 18px;">'+json.errorObject[i].msg+"</li>";if(json.errorObject[i].evi)msg+='<li style="list-style-type:none; padding-bottom: 2px; margin-left: 6px; font-family: monospace;">-&gt; '+
json.errorObject[i].evi.trim()+"</li>"}if(JP.ErrorWindow.Action.window.isVisible())JP.ErrorWindow.Action.window.update('<ul style="">'+msg+"</ul>");var errorContainer=Ext.get(Ext.query(".x-status-error-detail-link"));errorContainer.on("click",function(e,t,o){debug.trace(t.id);var cmp=Ext.getCmp(t.id);var pos=cmp.getPosition();if(JP.ErrorWindow.Action.me==null)JP.ErrorWindow.Action.me=this;JP.ErrorWindow.Action.openWindow();JP.ErrorWindow.Action.window.update('<ul style="">'+msg+"</ul>");JP.ErrorWindow.Action.window.setPosition(pos[0]+
25,pos[1])},this);return false}},parseJson:function(string){var lint=JSLINT(string);if(lint)try{return Ext.decode(string)}catch(err){return false}else{var errorArray=[];var i=null;for(i in JSLINT.errors){var extraCond=false;if(JSLINT.errors.length>1)if(parseInt(i)>JSLINT.errors.length-2)extraCond=true;if(i!="remove"&&i!="in_array"&&!extraCond){var errorMsg="Error on line {0} character {1}: {2}";var errorExplain=JSLINT.errors[i]["reason"]?JSLINT.errors[i]["reason"]:"";var err={line:JSLINT.errors[i]["line"],
character:JSLINT.errors[i]["character"],msg:String.format(errorMsg,JSLINT.errors[i]["line"],JSLINT.errors[i]["character"],errorExplain),evi:JSLINT.errors[i]["evidence"]};errorArray.push(err)}}return{errorObject:errorArray}}},setJPStatus:function(options,align){if(align=="left"){var sb=Ext.getCmp("JPmainStatusBar");sb.setStatus(options)}else if(align=="right"){var text="";if(Ext.type(options)=="object")text=options.text;else text=options;var sbRight=Ext.getCmp("JPmainStatusBar_Right");sbRight.setText(text)}},
clearJPStatus:function(align){if(align=="left"){var sb=Ext.getCmp("JPmainStatusBar");sb.clearStatus({anim:true})}else if(align=="right"){var sbRight=Ext.getCmp("JPmainStatusBar_Right");sbRight.setText("")}},setCodeMirrorStatus:function(options){var sb=Ext.getCmp("JPstringInputStatusBar");sb.setStatus(options)},clearCodeMirrorStatus:function(){var sb=Ext.getCmp("JPstringInputStatusBar");sb.clearStatus({anim:true})},getJsonTreeDefaultRootNode:function(rootType,children){var isLeaf=true;var icoClass=
"";var expanded=false;if(rootType!=null&&rootType!=""&&children!=null){isLeaf=false;icoClass="ico_"+rootType;expanded=true}var rootNode=new Ext.tree.TreeNode({text:"JSON",value:"|||JSON|ROOT|NODE|||",draggable:false,leaf:isLeaf,iconCls:icoClass,type:rootType,children:children,expanded:expanded});return rootNode},getJsonTreeNodeString:function(str,raw){var ind;switch(str.toLowerCase()){case "empty":ind=0;break;case "null":ind=1;break}if(raw)return JP.constant.NODE_STRING[ind];else return JP.constant.NODE_STRING[ind].replace(/\</g,
"&lt;").replace(/\>/g,"&gt;")}};JP.util.web={exit:function(){self.close()},copyToClipboard:function(string){},pasteFromClipboard:function(){}};
JP.util.air={exit:function(){var exitingEvent=new air.Event(air.Event.EXITING,false,true);air.NativeApplication.nativeApplication.dispatchEvent(exitingEvent);if(!exitingEvent.isDefaultPrevented())air.NativeApplication.nativeApplication.exit()},copyToClipboard:function(string){air.Clipboard.generalClipboard.clear();air.Clipboard.generalClipboard.setData(air.ClipboardFormats.TEXT_FORMAT,string,false)},pasteFromClipboard:function(){var txt=air.Clipboard.generalClipboard.getData(air.ClipboardFormats.TEXT_FORMAT);
if(txt==null)txt="";return txt.trim()}};JP.MainTop=Ext.extend(Ext.Panel,{title:"",region:"north",id:"JPtop",initComponent:function(){this.tbar={xtype:"container",layout:"anchor",cls:"parentToolbar",items:[{xtype:"jp_main_top_mainbar"},{xtype:"jp_main_top_iconbar"}]};JP.MainTop.superclass.initComponent.call(this)}});Ext.reg("jp_main_top",JP.MainTop);JP.MainTop.Action={copyJsonStringToClipboard:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];JP.util.copyToClipboard(stringInputField.getValue())},pasteJsonStringFromClipboard:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];var clipboardText=JP.util.pasteFromClipboard();stringInputField.setValue(clipboardText)},openXmlWindow:function(){if(JP.XmlWindow.Action.me==
null)JP.XmlWindow.Action.me=this;JP.XmlWindow.Action.openWindow()}};JP.MainTop.Action.mainBar={quitApplication:function(){JP.util.exit()},openAboutWindow:function(){if(JP.AboutWindow.Action.me==null)JP.AboutWindow.Action.me=this;JP.AboutWindow.Action.openWindow()}};
JP.MainTop.Action.iconBar={loadToTree:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];var value=stringInputField.getValue().trim();if(value=="")JP.util.setJPStatus({text:"Empty JSON string",iconCls:"x-status-error",clear:true},"left");else{var json=JP.util.parseJson(value,true);if(JP.util.validateJson(json,true)){var buildObjectForTree=function(obj,treeObj,lvl,parentIsArray){var ind=null;lvl++;for(ind in obj)if(ind!=
"remove"&&ind!="in_array"){var text=ind;var nodeType=Ext.type(obj[ind]);var nodeObject=new Object;nodeObject.id=Ext.id();if(isObject(obj[ind])&&obj[ind]!=null){if(parentIsArray)text="[object "+nodeType.toFirstUpperCase()+"]";nodeObject.iconCls="ico_"+nodeType;nodeObject.expandable=true;nodeObject.leaf=false;nodeObject.children=buildObjectForTree(obj[ind],[],lvl,nodeType=="array")}else{if(obj[ind]==null)nodeType="null";if(parentIsArray)text=obj[ind];nodeObject.expandable=false;nodeObject.leaf=true;
nodeObject.value=obj[ind]}nodeObject.text=text;nodeObject.type=nodeType;treeObj.push(nodeObject)}return treeObj};var rootType=value==""?null:Ext.type(json);var treeNodes=buildObjectForTree(json,[],0,rootType=="array");var root=JP.util.getJsonTreeDefaultRootNode(rootType,treeNodes);var tree=this.findParentByType("viewport").findByType("jp_main_center_jsonTree")[0];tree.setRootNode(root);tree.getLoader().load(tree.root);var editKeyForm=this.findParentByType("viewport").findByType("jp_main_center_ediTreeForm_tabs_edit")[0];
editKeyForm.formUnsaved=false;tree.getSelectionModel().select(tree.getRootNode());JP.util.setJPStatus({text:"Made succesfully a tree with the JSON string",iconCls:"x-status-valid",clear:true},"left")}}},loadFromTree:function(){var compress=false;var editKeyForm=this.findParentByType("viewport").findByType("jp_main_center_ediTreeForm_tabs_edit")[0];var tree=this.findParentByType("viewport").findByType("jp_main_center_jsonTree")[0];var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];
var rootNode=tree.getRootNode();var jsonString="";var lb="";var spacer="";var pt=":";if(editKeyForm.formUnsaved){var sm=tree.getSelectionModel();var selectedNode=sm.getSelectedNode();editKeyForm.confirmUnsaved(selectedNode);return false}if(!compress){lb="\n";spacer="\t";pt=" : "}var buildJSONString=function(node,jsonString,lvl,compress){lvl++;var tab="";for(var i=1;i<lvl;i++)tab+=spacer;var collapseNode=false;if(node.isExpandable()&&!node.isExpanded()){node.expand();collapseNode=true}node.eachChild(function(child){var childText=
child.attributes.text;childText=unescape(escape(childText).replace(/\%0A/g,"\\n"));childText=childText.replace(/\\n|\\r/g,"\\n").replace(/\"/g,'\\"');if(child.hasChildNodes()){if(child.attributes.type=="array"&&node.attributes.type!="array")jsonString+=tab+spacer+'"'+childText+'"'+pt+"["+lb;else{jsonString+=tab+spacer;if(node.attributes.type!="array")jsonString+='"'+childText+'"'+pt;jsonString+=(child.attributes.type=="array"?"[":"{")+lb}jsonString=tab+buildJSONString(child,jsonString,lvl,compress);
jsonString+=tab+spacer+(child.attributes.type=="array"?"]":"}")}else{var nodeValue=child.attributes.value;nodeValue=unescape(escape(nodeValue).replace(/\%0A/g,"\\n"));nodeValue=nodeValue.replace(/\\n|\\r/g,"\\n").replace(/\"/g,'\\"');if(child.attributes.type=="string")nodeValue='"'+nodeValue+'"';jsonString+=tab+spacer;if(node.attributes.type=="array")jsonString+=nodeValue;else jsonString+='"'+childText+'"'+pt+nodeValue}jsonString+=(!child.isLast()?",":"")+lb});if(collapseNode){node.collapse();collapseNode=
false}return jsonString};if(rootNode.attributes.type=="array")jsonString+="["+lb;else jsonString+="{"+lb;jsonString=buildJSONString(rootNode,jsonString,0,compress);if(rootNode.attributes.isArray)jsonString+="]"+lb;else jsonString+="}"+lb;stringInputField.setValue(jsonString.trim());JP.util.setJPStatus({text:"Tree built to JSON string",iconCls:"x-status-valid",clear:true},"left");return true},compressJsonString:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];
var stringCompressed=jsmin("",stringInputField.getValue(),3);stringInputField.setValue(stringCompressed.trim());JP.util.setJPStatus({text:"Compressed JSON string succesfully",iconCls:"x-status-valid",clear:true},"left")},formatJsonString:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];var json=JP.util.parseJson(stringInputField.getValue(),true);if(JP.util.validateJson(json,true)){stringInputField.setValue(JSON.stringify(json,
null,"  "));JP.util.setJPStatus({text:"Formatted JSON string succesfully",iconCls:"x-status-valid",clear:true},"left")}},validateJsonString:function(){var stringInputField=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];if(stringInputField.getValue().trim()=="")JP.util.setJPStatus({text:"Empty JSON string",iconCls:"x-status-error",clear:true},"left");else{var json=JP.util.parseJson(stringInputField.getValue(),true);if(JP.util.validateJson(json,
false))JP.util.setCodeMirrorStatus({text:"JSON string is valid",iconCls:"x-status-valid",clear:true})}},switchHighlighting:function(btn,pressed){var stringInput=this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];if(pressed==true)stringInput.showCodeMirror();else stringInput.hideCodeMirror()},insertExample:function(){this.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0].setValue(this.example)}};JP.MainTop.mainBar=Ext.extend(Ext.Toolbar,{initComponent:function(){this.items=[{text:"File",ref:"file",menu:{ref:"menu",items:[{text:"Quit",statusBarTip:"Quit the application",ref:"quit"}]}},{text:"Edit",ref:"edit",menu:{ref:"menu",items:[{text:"XML2JSON Converter",ref:"xml2json",statusBarTip:"Convert XML data to a JSON string and insert it in the textarea"},"-",{text:"Copy JSON string",ref:"copy",statusBarTip:"Copy JSON string to clipboard"},{text:"Paste JSON string",ref:"paste",statusBarTip:"Paste JSON string from cliboard"}]}},
{text:"Help",ref:"help",menu:{ref:"menu",items:[{text:"Check for updates",ref:"checkUpdate",statusBarTip:"Check if updates available"},"-",{text:"About...",ref:"about",statusBarTip:"About the application"}]}}];JP.MainTop.mainBar.superclass.initComponent.call(this);this.file.menu.quit.setHandler(JP.MainTop.Action.mainBar.quitApplication);this.edit.menu.xml2json.setHandler(JP.MainTop.Action.openXmlWindow,this);this.edit.menu.copy.setHandler(JP.MainTop.Action.copyJsonStringToClipboard,this);this.edit.menu.paste.setHandler(JP.MainTop.Action.pasteJsonStringFromClipboard,
this);this.help.menu.checkUpdate.setHandler(function(){UpdateApplication.checkUpdate(true)},this);this.help.menu.about.setHandler(JP.MainTop.Action.mainBar.openAboutWindow,this);this.file.menu.addListener("mouseover",this.onMenuMouseover);this.file.menu.addListener("mouseout",this.onMenuMouseout);this.edit.menu.addListener("mouseover",this.onMenuMouseover);this.edit.menu.addListener("mouseout",this.onMenuMouseout);this.help.menu.addListener("mouseover",this.onMenuMouseover);this.help.menu.addListener("mouseout",
this.onMenuMouseout)},onMenuMouseover:function(menu,e,menuItem){JP.util.setJPStatus({text:menuItem.statusBarTip,clear:false},"left")},onMenuMouseout:function(){JP.util.setJPStatus({text:"",clear:false},"left")}});Ext.reg("jp_main_top_mainbar",JP.MainTop.mainBar);JP.MainTop.iconBar=Ext.extend(Ext.Toolbar,{initComponent:function(){this.items=[{xtype:"buttongroup",title:"Tree",columns:2,ref:"btnGroup_tree",items:[{iconCls:"icon_loadToTree",scale:"medium",tooltip:"Load JSON String to tree",ref:"toTree"},{iconCls:"icon_loadFromTree",tooltip:"Load data from tree as JSON string",scale:"medium",ref:"fromTree"}]},{xtype:"buttongroup",title:"Format",columns:2,ref:"btnGroup_format",items:[{iconCls:"icon_format",scale:"medium",tooltip:"Format JSON string",ref:"indent"},
{iconCls:"icon_compress",scale:"medium",tooltip:"Compress JSON string",ref:"compress"}]},{xtype:"buttongroup",title:"Clipboard",columns:2,ref:"btnGroup_clipboard",items:[{iconCls:"icon_copy",scale:"medium",tooltip:"Copy JSON into clipboard",ref:"copy"},{iconCls:"icon_paste",scale:"medium",tooltip:"Paste JSON from clipboard",ref:"paste"}]},{xtype:"buttongroup",title:"Tools",columns:3,ref:"btnGroup_others",items:[{iconCls:"icon_convertXml",scale:"medium",tooltip:"Convert XML data to JSON",ref:"convertXML"},
{iconCls:"icon_validate",scale:"medium",tooltip:"Validate JSON string",ref:"validateJson"},{iconCls:"icon_highlight",id:"BtnJsonStringSyntaxHighlighting",scale:"medium",tooltip:"Turn on/off syntax highlighting",ref:"switchHighlighting",enableToggle:true,pressed:true}]},"->",{text:"Examples",scale:"large",tooltip:"Insert a JSON example",arrowAlign:"left",ref:"btnExamples",menu:{ref:"menu",items:[{text:"Example 1",ref:"example1",example:'{\n\t"Key": "value"\n}'},{text:"Example 2",ref:"example2",example:'{\n\t"CreditCard" : "MasterCard",\n\t"Number" : "1234-5678-9012-3456",\n\t"Holder" : {\n\t\t"Name" : "Rich",\n\t\t"firstName" : "Rainer",\n\t\t"sex" : "male",\n\t\t"Likes" : [\n\t\t\t"Riding",\n\t\t\t"Swimming",\n\t\t\t"Reading"\n\t\t],\n\t\t"Age" : null\n\t},\n\t"Covering" : 2000000,\n\t"Currency" : "EURO"\n}'},
{text:"Example 3",ref:"example3",example:'{\n\t"web-app" : {\n\t\t"servlet" : [\n\t\t\t{\n\t\t\t\t"servlet-name" : "cofaxCDS",\n\t\t\t\t"servlet-class" : "org.cofax.cds.CDSServlet",\n\t\t\t\t"init-param" : {\n\t\t\t\t\t"configGlossary:installationAt" : "Philadelphia, PA",\n\t\t\t\t\t"configGlossary:adminEmail" : "ksm@pobox.com",\n\t\t\t\t\t"configGlossary:poweredBy" : "Cofax",\n\t\t\t\t\t"configGlossary:poweredByIcon" : "/images/cofax.gif",\n\t\t\t\t\t"configGlossary:staticPath" : "/content/static",\n\t\t\t\t\t"templateProcessorClass" : "org.cofax.WysiwygTemplate",\n\t\t\t\t\t"templateLoaderClass" : "org.cofax.FilesTemplateLoader",\n\t\t\t\t\t"templatePath" : "templates",\n\t\t\t\t\t"templateOverridePath" : "",\n\t\t\t\t\t"defaultListTemplate" : "listTemplate.htm",\n\t\t\t\t\t"defaultFileTemplate" : "articleTemplate.htm",\n\t\t\t\t\t"useJSP" : false,\n\t\t\t\t\t"jspListTemplate" : "listTemplate.jsp",\n\t\t\t\t\t"jspFileTemplate" : "articleTemplate.jsp",\n\t\t\t\t\t"cachePackageTagsTrack" : 200,\n\t\t\t\t\t"cachePackageTagsStore" : 200,\n\t\t\t\t\t"cachePackageTagsRefresh" : 60,\n\t\t\t\t\t"cacheTemplatesTrack" : 100,\n\t\t\t\t\t"cacheTemplatesStore" : 50,\n\t\t\t\t\t"cacheTemplatesRefresh" : 15,\n\t\t\t\t\t"cachePagesTrack" : 200,\n\t\t\t\t\t"cachePagesStore" : 100,\n\t\t\t\t\t"cachePagesRefresh" : 10,\n\t\t\t\t\t"cachePagesDirtyRead" : 10,\n\t\t\t\t\t"searchEngineListTemplate" : "forSearchEnginesList.htm",\n\t\t\t\t\t"searchEngineFileTemplate" : "forSearchEngines.htm",\n\t\t\t\t\t"searchEngineRobotsDb" : "WEB-INF/robots.db",\n\t\t\t\t\t"useDataStore" : true,\n\t\t\t\t\t"dataStoreClass" : "org.cofax.SqlDataStore",\n\t\t\t\t\t"redirectionClass" : "org.cofax.SqlRedirection",\n\t\t\t\t\t"dataStoreName" : "cofax",\n\t\t\t\t\t"dataStoreDriver" : "com.microsoft.jdbc.sqlserver.SQLServerDriver",\n\t\t\t\t\t"dataStoreUrl" : "jdbc:microsoft:sqlserver://LOCALHOST:1433;DatabaseName=goon",\n\t\t\t\t\t"dataStoreUser" : "sa",\n\t\t\t\t\t"dataStorePassword" : "dataStoreTestQuery",\n\t\t\t\t\t"dataStoreTestQuery" : "SET NOCOUNT ON;select test=\'test\';",\n\t\t\t\t\t"dataStoreLogFile" : "/usr/local/tomcat/logs/datastore.log",\n\t\t\t\t\t"dataStoreInitConns" : 10,\n\t\t\t\t\t"dataStoreMaxConns" : 100,\n\t\t\t\t\t"dataStoreConnUsageLimit" : 100,\n\t\t\t\t\t"dataStoreLogLevel" : "debug",\n\t\t\t\t\t"maxUrlLength" : 500\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t}\n}'}]}}];
JP.MainTop.iconBar.superclass.initComponent.call(this);this.btnGroup_tree.toTree.setHandler(JP.MainTop.Action.iconBar.loadToTree,this);this.btnGroup_tree.fromTree.setHandler(JP.MainTop.Action.iconBar.loadFromTree,this);this.btnGroup_format.indent.setHandler(JP.MainTop.Action.iconBar.formatJsonString,this);this.btnGroup_format.compress.setHandler(JP.MainTop.Action.iconBar.compressJsonString,this);this.btnGroup_clipboard.copy.setHandler(JP.MainTop.Action.copyJsonStringToClipboard,this);this.btnGroup_clipboard.paste.setHandler(JP.MainTop.Action.pasteJsonStringFromClipboard,
this);this.btnGroup_others.convertXML.setHandler(JP.MainTop.Action.openXmlWindow,this);this.btnGroup_others.validateJson.setHandler(JP.MainTop.Action.iconBar.validateJsonString,this);this.btnGroup_others.switchHighlighting.on("toggle",JP.MainTop.Action.iconBar.switchHighlighting,this);this.btnExamples.menu.example1.setHandler(JP.MainTop.Action.iconBar.insertExample,this.btnExamples.menu.example1);this.btnExamples.menu.example2.setHandler(JP.MainTop.Action.iconBar.insertExample,this.btnExamples.menu.example2);
this.btnExamples.menu.example3.setHandler(JP.MainTop.Action.iconBar.insertExample,this.btnExamples.menu.example3)}});Ext.reg("jp_main_top_iconbar",JP.MainTop.iconBar);JP.MainCenter=Ext.extend(Ext.Panel,{title:"",region:"center",layout:"border",border:false,initComponent:function(){this.items=[{xtype:"jp_main_center_stringForm"},{xtype:"jp_main_center_jsonTree"},{xtype:"jp_main_center_ediTreeForm"}];JP.MainCenter.superclass.initComponent.call(this)}});Ext.reg("jp_main_center",JP.MainCenter);JP.MainCenter.Action={};
JP.MainCenter.Action.tree={addKeyNode:function(){JP.MainCenter.Action.tree.addNode("key",this)},addObjectNode:function(){JP.MainCenter.Action.tree.addNode("object",this)},addArrayNode:function(){JP.MainCenter.Action.tree.addNode("array",this)},addNode:function(nodeType,tree){var sm=tree.getSelectionModel();var selectedNode=sm.getSelectedNode();var parentNode=null;var collapseNode=false;if(selectedNode==null)selectedNode=tree.getRootNode();if(selectedNode.attributes.type=="object"||selectedNode.attributes.type==
"array"){parentNode=selectedNode;if(parentNode.isExpandable()&&!parentNode.isExpanded())parentNode.expand()}else parentNode=selectedNode.parentNode;if(!parentNode.hasChildNodes()&&parentNode.getDepth()==0){var root=JP.util.getJsonTreeDefaultRootNode("object",[]);tree.setRootNode(root);tree.getLoader().load(tree.root);parentNode=tree.getRootNode()}var newChildConfig=null;switch(nodeType){case "key":newChildConfig={leaf:true,expandable:false,value:"",type:"string"};break;case "object":case "array":newChildConfig=
{leaf:false,expandable:true,type:nodeType.toLowerCase(),iconCls:"ico_"+nodeType.toLowerCase()};break}newChildConfig.id=Ext.id();if(parentNode.attributes.type=="array"&&(nodeType=="object"||nodeType=="array"))newChildConfig.text="[object "+nodeType.toFirstUpperCase()+"]";else if(parentNode.attributes.type!="array")newChildConfig.text="New"+nodeType.toFirstUpperCase();else{newChildConfig.text=JP.util.getJsonTreeNodeString("empty",false);newChildConfig.value=""}var newNode=new Ext.tree.TreeNode(newChildConfig);
parentNode.insertBefore(newNode,selectedNode.nextSibling);if(newNode)sm.select(newNode)},duplicateNode:function(){var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];var sm=tree.getSelectionModel();var selectedNode=sm.getSelectedNode();var parentNode=selectedNode.parentNode;if(selectedNode!=null)if(selectedNode.getDepth()!=0){var duplicateTreeObj=function(node,obj){node.eachChild(function(child){var newChild=new Object;newChild.id=Ext.id();if(child.hasChildNodes()){newChild.iconCls=
child.attributes.iconCls;newChild.expandable=true;newChild.leaf=false;newChild.children=duplicateTreeObj(child,[])}else{newChild.expandable=false;newChild.leaf=true;newChild.value=child.attributes.value}newChild.text=child.attributes.text;newChild.type=child.attributes.type;obj.push(newChild)});return obj};var newNode=new Ext.tree.TreeNode;if(selectedNode.hasChildNodes()){var children=duplicateTreeObj(selectedNode,[]);newNode.appendChild(children)}else newNode.attributes.value=selectedNode.attributes.value;
var nodeText="";nodeText=selectedNode.attributes.text;if(selectedNode.attributes.text==JP.util.getJsonTreeNodeString("empty",false)&&selectedNode.attributes.text==JP.util.getJsonTreeNodeString("null",false))nodeText+=" Copy";newNode.setId(Ext.id());newNode.attributes.iconCls=selectedNode.attributes.iconCls;newNode.attributes.expandable=selectedNode.attributes.expandable;newNode.attributes.leaf=selectedNode.attributes.leaf;newNode.setText(nodeText);newNode.attributes.type=selectedNode.attributes.type;
parentNode.insertBefore(newNode,selectedNode.nextSibling);sm.select(newNode)}},deleteNode:function(){var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];var sm=tree.getSelectionModel();var selectedNode=sm.getSelectedNode();var previousSibling=selectedNode.previousSibling;var parentNode=selectedNode.parentNode;if(selectedNode)if(selectedNode.getDepth()!=0)selectedNode.remove();if(previousSibling)sm.select(previousSibling);else sm.select(parentNode)},setTreePath:function(node,
tree){var treePath=node.getPath("text");debug.trace(treePath);treePath=treePath.replace(/\<\//gi,"<|").substr(1,treePath.length).split("/");debug.dump(treePath);var treePathIds=node.getPath("id");treePathIds=treePathIds.substr(1,treePathIds.length).split("/");var rowNr=null;var pathStr="";var count=0;for(rowNr in treePath)if(rowNr!="remove"&&rowNr!="in_array"){var pathText=treePath[rowNr].replace(/\<\|/gi,"</");if(count==0)pathStr+="/ ";else if(node.id==treePathIds[rowNr])pathStr+=pathText;else pathStr+=
'<a href="#" class="tree-path-link" nodelinkid="'+treePathIds[rowNr]+'">'+pathText+"</a> / ";count++}var mainBottom=tree.findParentByType("viewport").findByType("jp_main_bottom")[0];mainBottom.updateContent(pathStr);Ext.get(Ext.query("a.tree-path-link")).on("click",function(e,el,obj){var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];var selectNode=tree.getNodeById(this.getAttribute("nodelinkid"));var selectionModel=tree.getSelectionModel();selectionModel.select(selectNode)})}};JP.MainCenter.stringForm=Ext.extend(Ext.FormPanel,{title:"",region:"north",layout:"fit",split:true,height:200,id:"JPsouth",initComponent:function(){var me=this;this.items=[{xtype:"ux-codemirror",codeMirrorPath:"core/extern/CodeMirror",language:"js",hideLabel:true,name:"jsonString",initCallBackFn:function(cm){me.setWidth(me.getWidth()-1);if(JSONpadAir.settings.syntax_hl=="false"){Ext.getCmp("JPviewPort").findByType("jp_main_top")[0].getTopToolbar().findByType("jp_main_top_iconbar")[0].btnGroup_others.switchHighlighting.toggle(false,
true);cm.hideCodeMirror()}}}];this.bbar={xtype:"statusbar",id:"JPstringInputStatusBar",statusAlign:"left",autoClear:2500,defaultText:"",text:"",iconCls:""};JP.MainCenter.stringForm.superclass.initComponent.call(this);me.addListener("resize",function(){var errorWindow=Ext.getCmp("JP_errorWindow");if(errorWindow)if(errorWindow.isVisible()){var errorContainer=Ext.get(Ext.query(".x-status-text")[0]);var cmp=Ext.getCmp(errorContainer.id);var pos=cmp.getPosition();JP.ErrorWindow.Action.window.setPosition(pos[0]+
25,pos[1])}})}});Ext.reg("jp_main_center_stringForm",JP.MainCenter.stringForm);JP.MainCenter.jsonTree=Ext.extend(Ext.tree.TreePanel,{title:"",region:"west",split:true,width:300,border:true,enableDD:true,autoScroll:true,ddGroup:"nodeDragAndDrop",treeContextMenu:null,initComponent:function(){var sm=this.getSelectionModel();var me=this;this.hiddenNodes=[];this.plugins=[new NodeMouseoverPlugin,new NodeMouseoutPlugin];this.tbar={xtype:"jp_main_center_jsonTree_toolbar"};this.root={text:"JSON",draggable:false,leaf:true,ref:"rnode",type:"object"};JP.MainCenter.jsonTree.superclass.initComponent.call(this);
me.addListener("afterRender",function(tree){var topBar=this.getTopToolbar();var btnDelete=topBar.deleteNode;var btnDuplicate=topBar.duplicateNode;me.treeContextMenu=new JP.MainCenter.jsonTree.contextMenu;new Ext.dd.DropTarget(btnDelete.el,{available:true,ddGroup:"nodeDragAndDrop",copy:false,notifyDrop:function(dd,e,data){(function(){JP.MainCenter.Action.tree.deleteNode()}).defer(50);return true}});new Ext.dd.DropTarget(btnDuplicate.el,{available:true,ddGroup:"nodeDragAndDrop",copy:false,notifyDrop:function(dd,
e,data){(function(){JP.MainCenter.Action.tree.duplicateNode()}).defer(50);return true}})},me);me.addListener("mouseover",function(node){if(node.getDepth()>0){var value=node.attributes.value;if(node.attributes.type=="array"||node.attributes.type=="object")value="<i>&lt;"+node.attributes.type.toFirstUpperCase()+"&gt;</i>";JP.util.setJPStatus({text:"<b>"+node.attributes.text+":</b>  "+value},"right")}else JP.util.clearJPStatus("right")});me.addListener("mouseout",function(node){JP.util.clearJPStatus("right")});
me.addListener("contextmenu",function(node,event){var selectionModel=me.getSelectionModel();selectionModel.select(node);me.treeContextMenu.showAt(event.getXY());event.stopEvent()},me);me.addListener("textchange",function(n,str,strOld){JP.MainCenter.Action.tree.setTreePath(n,this)},me);sm.addListener("beforeselect",function(sel,n,o){var editKeyForm=this.findParentByType("viewport").findByType("jp_main_center_ediTreeForm_tabs_edit")[0];var topBar=this.getTopToolbar();if(editKeyForm.formUnsaved){editKeyForm.confirmUnsaved(n);
return false}if(n.getDepth()==0){editKeyForm.disable();topBar.duplicateNode.disable();topBar.deleteNode.disable();this.treeContextMenu.duplicateNode.disable();this.treeContextMenu.deleteNode.disable()}else{topBar.duplicateNode.enable();topBar.deleteNode.enable();this.treeContextMenu.duplicateNode.enable();this.treeContextMenu.deleteNode.enable();var nodeText="";if(n.attributes.text==JP.util.getJsonTreeNodeString("empty",false))nodeText="";else if(n.attributes.text==JP.util.getJsonTreeNodeString("null",
false))nodeText="null";else nodeText=n.attributes.text;if(n.attributes.leaf==true){editKeyForm.keyForm.jsonkey.setValue(nodeText);editKeyForm.keyForm.jsonvalue.setValue(n.attributes.value);editKeyForm.keyForm.isnull.autoTrigger=false;editKeyForm.keyForm.isnull.setValue(n.attributes.type=="null");editKeyForm.keyForm.isnull.autoTrigger=true;if(n.parentNode!=null&&n.parentNode.attributes.type=="array")editKeyForm.keyForm.jsonkey.disable();else editKeyForm.keyForm.jsonkey.enable();if(n.attributes.type==
"null")editKeyForm.keyForm.jsonvalue.disable();else editKeyForm.keyForm.jsonvalue.enable();editKeyForm.enableKeyForm()}else{editKeyForm.enableObjectForm();editKeyForm.objectForm.jsonIndex.setValue(nodeText);if(n.parentNode.attributes.type=="array"){editKeyForm.objectForm.jsonIndex.setValue("ARRAY VALUE");editKeyForm.objectForm.jsonIndex.disable()}else editKeyForm.objectForm.jsonIndex.enable()}}JP.MainCenter.Action.tree.setTreePath(n,this);return true},me)},filterNodes:function(pattern,me){Ext.each(me.hiddenNodes,
function(n){n.ui.show()});if(!pattern)return;me.expandAll();var re=new RegExp("^.*"+Ext.escapeRe(pattern)+".*","i");me.root.cascade(function(n){if(re.test(n.text)||re.test(n.attributes.value)||n.getDepth()==0){n.ui.show();n.bubble(function(){this.ui.show()})}else{n.ui.hide();me.hiddenNodes.push(n)}},me)}});Ext.reg("jp_main_center_jsonTree",JP.MainCenter.jsonTree);JP.MainCenter.jsonTree.nodeToolbar=Ext.extend(Ext.Toolbar,{ref:"treetools",initComponent:function(){var me=this.findParentByType("jp_main_center_jsonTree");this.items=[{xtype:"button",iconCls:"icon_tree_addKey",tooltip:"Add a key/object/array",ref:"addNode",menu:{ref:"menu",items:[{xtype:"menuitem",text:"Add key",ref:"addKey"},{xtype:"tbseparator"},{xtype:"menuitem",text:"Add object",ref:"addObject"},{xtype:"menuitem",text:"Add array",ref:"addArray"}]}},{xtype:"button",iconCls:"icon_tree_duplicate",
tooltip:"Duplicate selected node",disabled:true,ref:"duplicateNode"},{xtype:"button",iconCls:"icon_tree_delete",tooltip:"Delete selected node",disabled:true,ref:"deleteNode"},"->",new Ext.form.TextField({width:100,emptyText:"Search inside tree",enableKeyEvents:true,listeners:{render:function(f){this.filter=new Ext.tree.TreeFilter(this,{clearBlank:true,autoClear:true})},keydown:{fn:function(t,e){this.filterNodes(t.getValue(),this)},buffer:350,scope:me},scope:me}})];JP.MainCenter.jsonTree.nodeToolbar.superclass.initComponent.call(this);
var tree=this.findParentByType("jp_main_center_jsonTree");this.addNode.menu.addKey.setHandler(JP.MainCenter.Action.tree.addKeyNode,tree);this.addNode.menu.addObject.setHandler(JP.MainCenter.Action.tree.addObjectNode,tree);this.addNode.menu.addArray.setHandler(JP.MainCenter.Action.tree.addArrayNode,tree);this.duplicateNode.setHandler(JP.MainCenter.Action.tree.duplicateNode,tree);this.deleteNode.setHandler(JP.MainCenter.Action.tree.deleteNode,tree)}});Ext.reg("jp_main_center_jsonTree_toolbar",JP.MainCenter.jsonTree.nodeToolbar);JP.MainCenter.jsonTree.contextMenu=Ext.extend(Ext.menu.Menu,{initComponent:function(){this.items=[{text:"Add",iconCls:"icon_tree_addKey",ref:"addNode",menu:{ref:"menu",items:[{text:"Add Key",ref:"addKey"},"-",{text:"Add Object",ref:"addObject"},{text:"Add Array",ref:"addArray"}]}},{text:"Duplicate",iconCls:"icon_tree_duplicate",ref:"duplicateNode"},"-",{text:"Delete",iconCls:"icon_tree_delete",ref:"deleteNode"}];JP.MainCenter.jsonTree.contextMenu.superclass.initComponent.call(this);var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];
this.addNode.menu.addKey.setHandler(JP.MainCenter.Action.tree.addKeyNode,tree);this.addNode.menu.addObject.setHandler(JP.MainCenter.Action.tree.addObjectNode,tree);this.addNode.menu.addArray.setHandler(JP.MainCenter.Action.tree.addArrayNode,tree);this.duplicateNode.setHandler(JP.MainCenter.Action.tree.duplicateNode,tree);this.deleteNode.setHandler(JP.MainCenter.Action.tree.deleteNode,tree)}});Ext.reg("jp_main_center_jsonTree_contextMenu",JP.MainCenter.jsonTree.contextMenu);JP.MainCenter.ediTreeForm=Ext.extend(Ext.Panel,{activeTab:0,region:"center",resizeTabs:true,layout:"fit",initComponent:function(){var me=this;this.items=[{xtype:"jp_main_center_ediTreeForm_tabs"}];this.tbar={items:[{iconCls:"icon_small_save",scale:"small",disabled:true,tooltip:"Save data",ref:"save"}]};JP.MainCenter.ediTreeForm.superclass.initComponent.call(this);var tb=me.getTopToolbar();tb.save.setHandler(function(){var getActiveTab=this.findByType("jp_main_center_ediTreeForm_tabs")[0].getActiveTab();
var activeTabXtype=getActiveTab.getXType();switch(activeTabXtype){case "jp_main_center_ediTreeForm_tabs_edit":this.findByType("jp_main_center_ediTreeForm_tabs_edit")[0].saveForm(getActiveTab);break}},me);me.addListener("resize",function(){this.findByType("jp_main_center_ediTreeForm_tabs")[0].setHeight("100%");this.findByType("jp_main_center_ediTreeForm_tabs")[0].setWidth("100%");this.findByType("jp_main_center_ediTreeForm_tabs_edit")[0].setHeight("100%");this.findByType("jp_main_center_ediTreeForm_tabs_edit")[0].setWidth("100%");
this.findByType("jp_main_center_ediTreeForm_tabs_edit_key")[0].setHeight("100%");this.findByType("jp_main_center_ediTreeForm_tabs_edit_key")[0].setWidth("100%")},me)}});Ext.reg("jp_main_center_ediTreeForm",JP.MainCenter.ediTreeForm);JP.MainCenter.ediTreeForm.tabs=Ext.extend(Ext.TabPanel,{activeTab:0,resizeTabs:true,border:false,initComponent:function(){var me=this;this.items=[{xtype:"jp_main_center_ediTreeForm_tabs_edit"}];JP.MainCenter.ediTreeForm.tabs.superclass.initComponent.call(this)}});Ext.reg("jp_main_center_ediTreeForm_tabs",JP.MainCenter.ediTreeForm.tabs);JP.MainCenter.ediTreeForm.tabs.edit=Ext.extend(Ext.Panel,{title:"Edit",layout:"anchor",frame:false,border:false,disabled:true,formUnsaved:false,initComponent:function(){var me=this;this.items=[{xtype:"jp_main_center_ediTreeForm_tabs_edit_key"},{xtype:"jp_main_center_ediTreeForm_tabs_edit_object"}];JP.MainCenter.ediTreeForm.tabs.edit.superclass.initComponent.call(this);me.addListener("afterrender",function(){this.disable()},me);me.addListener("disable",function(){this.keyForm.jsonkey.setValue("");
this.keyForm.jsonvalue.setValue("");this.keyForm.isnull.setValue(false);this.keyForm.hide();this.objectForm.jsonIndex.setValue("");this.objectForm.hide();var tb=this.findParentByType("jp_main_center_ediTreeForm").getTopToolbar();tb.save.disable();this.formUnsaved=false},me);me.addListener("enable",function(){},me)},enableKeyForm:function(){if(this.disabled)this.enable();if(this.objectForm.isVisible())this.objectForm.hide();if(!this.keyForm.isVisible())this.keyForm.show()},enableObjectForm:function(){if(this.disabled)this.enable();
if(this.keyForm.isVisible())this.keyForm.hide();if(!this.objectForm.isVisible())this.objectForm.show()},formChanged:function(){var tb=this.findParentByType("jp_main_center_ediTreeForm").getTopToolbar();tb.save.enable();this.formUnsaved=true},confirmUnsaved:function(n){var form=Ext.getCmp("JPviewPort").findByType("jp_main_center_ediTreeForm_tabs_edit")[0];Ext.MessageBox.confirm("Form is unsaved!","Your data is unsaved. Save before doing action?",function(button){if(button=="yes")form.saveForm(form);
else if(button=="no"){debug.trace("nno");form.formUnsaved=false;debug.trace(form.formUnsaved)}var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];var sm=tree.getSelectionModel();sm.select(n);return true})},saveForm:function(form){var activeForm=null;var tree=Ext.getCmp("JPviewPort").findByType("jp_main_center_jsonTree")[0];var treeSm=tree.getSelectionModel();var node=treeSm.getSelectedNode();var statustext="";if(form.keyForm.isVisible()){activeForm=form.keyForm;var jsonIsNull=
activeForm.isnull.getValue();var jsonKey=activeForm.jsonkey.getValue();var jsonValue=jsonIsNull?"null":activeForm.jsonvalue.getValue();if(jsonIsNull||jsonValue==null)node.attributes.type="null";else node.attributes.type=Ext.type(jsonValue);if(node.parentNode.attributes.type=="array"){var nodeText="";if(jsonValue=="")nodeText=JP.util.getJsonTreeNodeString("empty",false);else if(jsonValue=="null")nodeText=JP.util.getJsonTreeNodeString("null",false);else nodeText=jsonValue;node.setText(nodeText);activeForm.jsonkey.setValue(jsonValue)}else node.setText(jsonKey!=
""?jsonKey:JP.util.getJsonTreeNodeString("empty",false));node.attributes.value=jsonValue;statustext="Saved selected key successfully"}else if(form.objectForm.isVisible()){activeForm=form.objectForm;var jsonIndex=activeForm.jsonIndex.getValue();node.setText(jsonIndex!=""?jsonIndex:JP.util.getJsonTreeNodeString("empty",false));statustext="Saved selected "+node.attributes.type+" successfully"}var tb=form.findParentByType("jp_main_center_ediTreeForm").getTopToolbar();tb.save.disable();JP.util.setJPStatus({text:statustext,
iconCls:"x-status-valid",clear:true},"left");form.formUnsaved=false}});Ext.reg("jp_main_center_ediTreeForm_tabs_edit",JP.MainCenter.ediTreeForm.tabs.edit);JP.MainCenter.ediTreeForm.tabs.edit.jsonKey=Ext.extend(Ext.FormPanel,{layout:"form",frame:true,border:false,ref:"keyForm",anchor:"100% 100%",initComponent:function(){var me=this;this.items=[{xtype:"textarea",fieldLabel:"Key",anchor:"100%",name:"jsonKey",ref:"jsonkey",enableKeyEvents:true},{xtype:"textarea",fieldLabel:"Value",anchor:"100%",name:"jsonValue",ref:"jsonvalue",enableKeyEvents:true},{xtype:"checkbox",fieldLabel:"isNull",anchor:"100%",name:"isNull",ref:"isnull"}];JP.MainCenter.ediTreeForm.tabs.edit.jsonKey.superclass.initComponent.call(this);
var tabsEdit=me.findParentByType("jp_main_center_ediTreeForm_tabs_edit");this.jsonkey.addListener("change",tabsEdit.formChanged,tabsEdit);this.jsonvalue.addListener("change",tabsEdit.formChanged,tabsEdit);this.isnull.addListener("change",tabsEdit.formChanged,tabsEdit);this.isnull.addListener("check",function(checkbox,checked){if(this.isnull.autoTrigger){if(checked){this.jsonvalue.setValue("null");this.jsonvalue.disable()}else{this.jsonvalue.setValue("");this.jsonvalue.enable()}this.jsonvalue.fireEvent("change")}},
this);this.isnull.addListener("afterrender",function(c){new Ext.ToolTip({target:this.isnull.id,html:'Set value to "null"'})},this);var str="";this.jsonkey.addListener("keydown",function(){if(!tabsEdit.formUnsaved)str=this.getValue()},this.jsonkey);this.jsonkey.addListener("keyup",function(){if(str!=this.getValue()&&!tabsEdit.formUnsaved)this.fireEvent("change")},this.jsonkey);this.jsonvalue.addListener("keydown",function(){if(!tabsEdit.formUnsaved)str=this.getValue()},this.jsonvalue);this.jsonvalue.addListener("keyup",
function(){if(str!=this.getValue()&&!tabsEdit.formUnsaved)this.fireEvent("change")},this.jsonvalue)}});Ext.reg("jp_main_center_ediTreeForm_tabs_edit_key",JP.MainCenter.ediTreeForm.tabs.edit.jsonKey);JP.MainCenter.ediTreeForm.tabs.edit.jsonObject=Ext.extend(Ext.FormPanel,{layout:"form",frame:true,border:false,ref:"objectForm",anchor:"100% 100%",initComponent:function(){var me=this;this.items=[{xtype:"textarea",fieldLabel:"Indexname",anchor:"100%",name:"jsonIndex",ref:"jsonIndex",enableKeyEvents:true}];JP.MainCenter.ediTreeForm.tabs.edit.jsonObject.superclass.initComponent.call(this);var tabsEdit=me.findParentByType("jp_main_center_ediTreeForm_tabs_edit");this.jsonIndex.addListener("change",tabsEdit.formChanged,
tabsEdit);var str="";this.jsonIndex.addListener("keydown",function(){if(!tabsEdit.formUnsaved)str=this.getValue()},this.jsonkey);this.jsonIndex.addListener("keyup",function(){if(str!=this.getValue()&&!tabsEdit.formUnsaved)this.fireEvent("change")},this.jsonkey)}});Ext.reg("jp_main_center_ediTreeForm_tabs_edit_object",JP.MainCenter.ediTreeForm.tabs.edit.jsonObject);JP.MainBottom=Ext.extend(Ext.Panel,{title:"",region:"south",cls:"main-bottom-panel",initComponent:function(){this.bbar={xtype:"statusbar",id:"JPmainStatusBar",ref:"jpstatus",statusAlign:"left",autoClear:2500,defaultText:"",text:"",iconCls:"",items:[" ",{xtype:"tbtext",id:"JPmainStatusBar_Right",text:"&nbsp;"}]};JP.MainBottom.superclass.initComponent.call(this);this.addListener("afterrender",function(){this.updateContent("/")},this)},updateContent:function(str){Ext.get(Ext.query("div.main-bottom-panel div.x-panel-body")[0]).update(str)}});
Ext.reg("jp_main_bottom",JP.MainBottom);JP.XmlWindow=Ext.extend(Ext.Window,{layout:"fit",width:700,height:500,closeAction:"hide",plain:true,modal:true,title:"Convert XML data to a JSON string",id:"JP_convertXmlWindow",initComponent:function(){var me=this;this.items=[{xtype:"jp_xmlwindow_xmlform"}];this.buttons=[{text:"Submit",handler:function(){var xmlData=me.xmlForm.xmlInput.getValue();JP.XmlWindow.Action.setJsonData(xmlData);JP.XmlWindow.Action.window.hide()}},{text:"Close",handler:function(){JP.XmlWindow.Action.window.hide()}}];JP.XmlWindow.superclass.initComponent.call(this)}});
Ext.reg("jp_xmlwindow",JP.XmlWindow);JP.XmlWindow.Action={me:null,window:null,setXmlData:function(){var me=JP.XmlWindow.Action.me;var stringInputField=me.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];var value=stringInputField.getValue();if(value.trim()!=""){var json=JP.util.parseJson(value);var xmlInputField=Ext.getCmp("JP_convertXmlWindow").findByType("jp_xmlwindow_xmlform")[0].findByType("ux-codemirror")[0];if(JP.util.validateJson(json,true)){var xmlData=xmlJsonClass.json2xml(json,
"  ");var xmlDataArr=xmlData.split("\n");for(var i=0;i<xmlDataArr.length;i++)xmlDataArr[i]=(i<xmlDataArr.length-1?"  ":"")+xmlDataArr[i];xmlData="<root>\n"+xmlDataArr.join("\n")+"</root>";xmlInputField.setValue(xmlData)}else xmlInputField.setValue("")}else stringInputField.setValue("")},setJsonData:function(xmlData){if(xmlData.trim()!=""){var me=JP.XmlWindow.Action.me;var stringInputField=me.findParentByType("viewport").findByType("jp_main_center_stringForm")[0].findByType("ux-codemirror")[0];var jsonData=
xmlJsonClass.xml2json(parseXml(xmlData),"  ",true);stringInputField.setValue(jsonData)}},openWindow:function(){if(!JP.XmlWindow.Action.window)JP.XmlWindow.Action.window=new JP.XmlWindow;else JP.XmlWindow.Action.setXmlData();JP.XmlWindow.Action.window.show()}};
JP.XmlWindow.Action.tbar={copyXmlStringToClipboard:function(){var xmlInputField=Ext.getCmp("JP_convertXmlWindow").findByType("jp_xmlwindow_xmlform")[0].findByType("ux-codemirror")[0];JP.util.copyToClipboard(xmlInputField.getValue())},pasteXmlStringFromClipboard:function(){var xmlInputField=Ext.getCmp("JP_convertXmlWindow").findByType("jp_xmlwindow_xmlform")[0].findByType("ux-codemirror")[0];var clipboardText=JP.util.pasteFromClipboard();xmlInputField.setValue(clipboardText)},switchHighlighting:function(btn,
pressed){var xmlInputField=Ext.getCmp("JP_convertXmlWindow").findByType("jp_xmlwindow_xmlform")[0].findByType("ux-codemirror")[0];if(pressed==true)xmlInputField.showCodeMirror();else xmlInputField.hideCodeMirror()}};JP.XmlWindow.xmlForm=Ext.extend(Ext.FormPanel,{layout:"form",frame:false,hideLabel:true,ref:"xmlForm",initComponent:function(){var me=this;this.tbar={items:[{xtype:"buttongroup",title:"Clipboard",columns:2,ref:"btnGroup_clipboard",items:[{iconCls:"icon_copy",scale:"medium",tooltip:"Copy JSON into clipboard",ref:"copy"},{iconCls:"icon_paste",scale:"medium",tooltip:"Paste JSON from clipboard",ref:"paste"}]},{xtype:"buttongroup",title:"Tools",columns:2,ref:"btnGroup_others",items:[{iconCls:"icon_highlight",
scale:"medium",tooltip:"Turn on/off syntax highlighting",ref:"switchHighlighting",enableToggle:true,pressed:true}]}]};this.items=[{xtype:"ux-codemirror",codeMirrorPath:"core/extern/CodeMirror",language:"xml",hideLabel:true,anchor:"100% 100%",name:"xmlData",ref:"xmlInput",onResizeCallBackFn:function(codeMirror){var el=Ext.select("."+codeMirror.id,true);var lineNumbersEl=Ext.select("."+codeMirror.id+" ~ div",true);var win=me;var width=win.getWidth();var height=win.getHeight();if(el){if(codeMirror.initialized&&
!codeMirror.codeMirrorHidden&&lineNumbersEl&&count(lineNumbersEl.elements)&&width)width=width-lineNumbersEl.elements[0].getWidth();for(var i=0;i<el.elements.length;i++){if(width&&!height)el.elements[i].setWidth(width);else if(!width&&height)el.elements[i].setHeight(height);else if(width&&height)el.elements[i].setSize(width-3,height-1);lineNumbersEl.elements[i].setHeight(height)}}},initCallBackFn:function(me){me.findParentByType("jp_xmlwindow").setWidth(me.findParentByType("jp_xmlwindow").getWidth()-
1);JP.XmlWindow.Action.setXmlData()}}];JP.XmlWindow.xmlForm.superclass.initComponent.call(this);var tb=this.getTopToolbar();tb.btnGroup_clipboard.copy.setHandler(JP.XmlWindow.Action.tbar.copyXmlStringToClipboard,this);tb.btnGroup_clipboard.paste.setHandler(JP.XmlWindow.Action.tbar.pasteXmlStringFromClipboard,this);tb.btnGroup_others.switchHighlighting.on("toggle",JP.XmlWindow.Action.tbar.switchHighlighting,this)}});Ext.reg("jp_xmlwindow_xmlform",JP.XmlWindow.xmlForm);JP.AboutWindow=Ext.extend(Ext.Window,{layout:"fit",width:400,height:300,closeAction:"hide",plain:true,modal:true,resizable:false,draggable:false,title:"About JSONpad",id:"JP_aboutWindow",initComponent:function(){var me=this;var text='<span style="font-size: 11px;">'+"<p>This project started by Christopher S&ouml;llinger and is a Non-Profit free software licensed with the {2}. It is open source, so feel "+"free to download the latest source code at {3}.<br />&nbsp;<br />"+"If you have any problems with this application you can contact me over different ways:</p>"+
"<p>- Write it to {4}<br />"+"-&nbsp;Or you can even post an issue to {5}<br />"+"-&nbsp;Or just get it contact with me:<br />"+'&nbsp;&nbsp;<a href="#" id="mailto:zerogiven@gmail.com" class="link-to-browser">zerogiven@gmail.com</a><br />'+'&nbsp;&nbsp;<a href="#" id="http://www.twitter.com/JSONpad/" class="link-to-browser">http://www.twitter.com/JSONpad</a>'+"</p>&nbsp;<br />"+"<p><b>Thanks to:</b><br />"+"<i>Douglas Crockford</i> :: For his excellent work with JavaScript. JSlint, JSmin and JSONparse are used from his scripts.<br />&nbsp;<br />"+
"<i>Stefan Goessner</i> :: Very good JSON2xml script. Not needed to code again ;)</p>&nbsp;<br />"+"<p>If you want have more informations or news about JSONpad, feel free to visit the {6} or the {7}.</p>&nbsp;<br />"+"</span>"+'<span style="font-size: 9px;">'+"JSONpad Version Number: {0}<br />"+"ExtJS Version Number: {1}<br />&nbsp;<br />"+"</span>";var jsonPadVersion=UpdateApplication.getApplicationVersion();var extjsVersion=Ext.version;var licenseLink='<a href="#" id="http://www.jsonpad.co.cc/new_bsd_license.txt" class="link-to-browser">New BSD License</a>';
var googleCodeLink='<a href="#" id="http://code.google.com/p/json-pad/" class="link-to-browser">Google Code</a>';var googleGroupsLink='<a href="#" id="http://groups.google.com/group/jsonpad" class="link-to-browser">Google Groups</a>';var homepageLink='<a href="#" id="http://www.jsonpad.co.cc/" class="link-to-browser">homepage</a>';var blogLink='<a href="#" id="http://jsonpad.blogspot.com/" class="link-to-browser">blog</a>';var aboutHtml=String.format(text,jsonPadVersion,extjsVersion,licenseLink,googleCodeLink,
googleGroupsLink,googleCodeLink,homepageLink,blogLink);this.items=[new Ext.Panel({autoScroll:true,html:'<div style="padding: 5px;">'+aboutHtml+"</div>"})];JP.AboutWindow.superclass.initComponent.call(this);this.addListener("afterrender",function(){Ext.select("a.link-to-browser").on("click",function(e,el){var href=el.id;openUrl(href);return false})})}});Ext.reg("jp_aboutwindow",JP.AboutWindow);JP.AboutWindow.Action={me:null,window:null,openWindow:function(){if(!JP.AboutWindow.Action.window)JP.AboutWindow.Action.window=new JP.AboutWindow;JP.AboutWindow.Action.window.show()}};JP.ErrorWindow=Ext.extend(Ext.Window,{layout:"fit",closeAction:"hide",plain:true,x:0,y:0,baseCls:"x-tip",bodyBorder:false,draggable:false,resizable:false,html:"Dummytext",id:"JP_errorWindow",initComponent:function(){var me=this;JP.ErrorWindow.superclass.initComponent.call(this)}});Ext.reg("jp_errorwindow",JP.ErrorWindow);JP.ErrorWindow.Action={me:null,window:null,init:function(){if(!JP.ErrorWindow.Action.window)JP.ErrorWindow.Action.window=new JP.ErrorWindow},openWindow:function(){if(!JP.ErrorWindow.Action.window)JP.ErrorWindow.Action.init();JP.ErrorWindow.Action.window.show()}};